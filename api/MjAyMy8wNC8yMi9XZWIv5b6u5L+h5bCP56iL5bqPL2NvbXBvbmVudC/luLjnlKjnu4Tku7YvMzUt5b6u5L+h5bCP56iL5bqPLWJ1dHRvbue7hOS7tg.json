{"title":"微信小程序-button组件","date":"2023-04-22T15:11:08.000Z","date_formatted":{"ll":"Apr 22, 2023","L":"04/22/2023","MM-DD":"04-22"},"link":"2023/04/22/Web/微信小程序/component/常用组件/35-微信小程序-button组件","tags":["微信小程序"],"updated":"2023-04-23T12:34:26.500Z","content":"<h1 id=\"button\">button<a title=\"#button\" href=\"#button\"></a></h1>\n<p>官方文档地址：<a href=\"https://developers.weixin.qq.com/miniprogram/dev/component/button.html\" target=\"_blank\">https://developers.weixin.qq.com/miniprogram/dev/component/button.html</a></p>\n<p>我这里废话不多说，很简单就是直接来使用这个组件，说下使用当中的注意点。</p>\n<h1 id=\"属性\">属性<a title=\"#属性\" href=\"#属性\"></a></h1>\n<p>!&gt; 注意点：默认情况下小程序中的按钮是块级元素</p>\n<h2 id=\"size\">size<a title=\"#size\" href=\"#size\"></a></h2>\n<p>设置按钮的大小：</p>\n<p>?&gt; 默认情况下 size 的取值为 default，显示的样式为：display：block</p>\n<p>index.wxml:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">size</span>=<span class=\"hljs-string\">&quot;default&quot;</span>&gt;</span>我是按钮<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<p>?&gt; 如果设置 size 的取值为 mini，那么就会从 display：block 修改为 display：inline-block</p>\n<p>index.wxml:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">size</span>=<span class=\"hljs-string\">&quot;mini&quot;</span>&gt;</span>我是按钮<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">text</span>&gt;</span>我是text<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">text</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202304/2105804-20230422231636872-1040687443.png\" alt=\"image-20230422231636167\" loading=\"lazy\" class=\"φbp\"></p>\n<h2 id=\"type\">type<a title=\"#type\" href=\"#type\"></a></h2>\n<p>按钮的样式类型：</p>\n<p>!&gt; 注意点：type 仅仅是提供了一些内置样式，如果不满足我们的需求也可以通过 CSS 自定义按钮样式。</p>\n<p>index.wxml:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;primary&quot;</span>&gt;</span>我是按钮<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;default&quot;</span>&gt;</span>我是按钮<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;warn&quot;</span>&gt;</span>我是按钮<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h2 id=\"plain\">plain<a title=\"#plain\" href=\"#plain\"></a></h2>\n<p>按钮是否镂空，背景色透明:</p>\n<p>index.wxml:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;primary&quot;</span> <span class=\"hljs-attr\">plain</span>=<span class=\"hljs-string\">&quot;&#123;&#123;true&#125;&#125;&quot;</span>&gt;</span>我是按钮<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h2 id=\"disabled\">disabled<a title=\"#disabled\" href=\"#disabled\"></a></h2>\n<p>是否禁用:</p>\n<p>index.wxml:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;primary&quot;</span> <span class=\"hljs-attr\">plain</span>=<span class=\"hljs-string\">&quot;&#123;&#123;true&#125;&#125;&quot;</span> <span class=\"hljs-attr\">disabled</span>=<span class=\"hljs-string\">&quot;&#123;&#123;true&#125;&#125;&quot;</span>&gt;</span>我是按钮<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h2 id=\"loading\">loading<a title=\"#loading\" href=\"#loading\"></a></h2>\n<p>名称前是否带 loading 图标:</p>\n<p>index.wxml:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;primary&quot;</span> <span class=\"hljs-attr\">loading</span>=<span class=\"hljs-string\">&quot;&#123;&#123;true&#125;&#125;&quot;</span>&gt;</span>我是按钮<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<p>看了那么多属性，其实都不是我重点要介绍的，在 button 组件中，有一个叫  open-type 的属性，这个属性官方的描述是 <code>微信开放能力</code>。</p>\n<h2 id=\"open-type\">open-type<a title=\"#open-type\" href=\"#open-type\"></a></h2>\n<h3 id=\"获取用户信息\">获取用户信息<a title=\"#获取用户信息\" href=\"#获取用户信息\"></a></h3>\n<p>开始使用一下，在文档当中我发现可以获取用户信息，（这里是一个错误的步骤，问题就是官方没有更新文档，后面有正确的打开方式也就是获取方式）</p>\n<p>?&gt; open-type=getUserInfo： 获取用户信息，可以从bindgetuserinfo回调中获取到用户信息 （<em>小程序插件中不能使用</em>）</p>\n<p>index.wxml:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;default&quot;</span></span><br><span class=\"hljs-tag\">        <span class=\"hljs-attr\">open-type</span>=<span class=\"hljs-string\">&quot;getUserInfo&quot;</span></span><br><span class=\"hljs-tag\">        <span class=\"hljs-attr\">bindgetuserinfo</span>=<span class=\"hljs-string\">&quot;onGetUserInfo&quot;</span></span><br><span class=\"hljs-tag\">&gt;</span>获取用户信息<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<p>index.js:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-title class_\">Page</span>(&#123;<br>  <span class=\"hljs-title function_\">onGetUserInfo</span>(<span class=\"hljs-params\">event</span>)&#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(event);<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n<p>点击按钮的返回值：</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs text\">rawData: &quot;&#123;&quot;nickName&quot;:&quot;微信用户&quot;,&quot;gender&quot;:0,&quot;language&quot;:&quot;&quot;,&quot;city&quot;:&quot;&quot;,&quot;province&quot;:&quot;&quot;,&quot;country&quot;:&quot;&quot;,&quot;avatarUrl&quot;:&quot;https://thirdwx.qlogo.cn/mmopen/vi_32/POgEwh4mIHO4nibH0KlMECNjjGxQUq24ZEaGT4poC6icRiccVGKSyXwibcPq4BWmiaIGuG1icwxaQX6grC9VemZoJ8rg/132&quot;&#125;&quot;<br></code></pre></td></tr></table></figure>\n<p>avatarUrl 的头像是错误的，好了这里我说了一堆无用的，是个错误的示例，然后我们来看看正确的方式获取，正确的获取方式其实很简单，就是写一个按钮，然后调用下微信提供的 API 即可，如下：</p>\n<p>官方文档：<a href=\"https://developers.weixin.qq.com/miniprogram/dev/api/open-api/user-info/wx.getUserProfile.html\" target=\"_blank\">https://developers.weixin.qq.com/miniprogram/dev/api/open-api/user-info/wx.getUserProfile.html</a></p>\n<p>index.wxml:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;default&quot;</span></span><br><span class=\"hljs-tag\">        <span class=\"hljs-attr\">bindtap</span>=<span class=\"hljs-string\">&quot;onGetUserInfo&quot;</span></span><br><span class=\"hljs-tag\">&gt;</span>获取用户信息<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<p>index.js:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-title class_\">Page</span>(&#123;<br>  <span class=\"hljs-title function_\">onGetUserInfo</span>(<span class=\"hljs-params\">event</span>)&#123;<br>    wx.<span class=\"hljs-title function_\">getUserProfile</span>(&#123;<br>      <span class=\"hljs-attr\">desc</span>: <span class=\"hljs-string\">&#x27;BNTang 就是要获取&#x27;</span>,<br>      <span class=\"hljs-attr\">success</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">res</span>)=&gt;</span>&#123;<br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res);<br>      &#125;<br>    &#125;)<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n<p>点击按钮的返回值：</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs text\">rawData: &quot;&#123;&quot;nickName&quot;:&quot;ㅤ　　　　　　　　&quot;,&quot;gender&quot;:0,&quot;language&quot;:&quot;zh_CN&quot;,&quot;city&quot;:&quot;&quot;,&quot;province&quot;:&quot;&quot;,&quot;country&quot;:&quot;&quot;,&quot;avatarUrl&quot;:&quot;https://thirdwx.qlogo.cn/mmopen/vi_32/oKkJltWzg8IbkrI4ia5QODcRA2o9B0RnFQ6QznA5Y4HuMQOePyh6SSqEbKGzo1YGGsHNSq4Dg6v8ZxnmibGH6ZHA/132&quot;&#125;&quot;<br></code></pre></td></tr></table></figure>\n<h3 id=\"获取用户手机号\">获取用户手机号<a title=\"#获取用户手机号\" href=\"#获取用户手机号\"></a></h3>\n<p>?&gt; open-type=getPhoneNumber：获取用户手机号，可以从bindgetphonenumber回调中获取到用户信息，<a href=\"https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/getPhoneNumber.html\" target=\"_blank\">具体说明</a> （<em>小程序插件中不能使用</em>）</p>\n<ul>\n<li>如果想获取用户的手机号，只有在前端是无法获取的，需要后端配合才能获取。</li>\n</ul>\n<p>index.wxml:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">open-type</span>=<span class=\"hljs-string\">&quot;getPhoneNumber&quot;</span> <span class=\"hljs-attr\">bindgetphonenumber</span>=<span class=\"hljs-string\">&quot;onGetPhoneNumber&quot;</span>&gt;</span>获取用户手机号<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<p>index.js:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-title class_\">Page</span>(&#123;<br>  <span class=\"hljs-title function_\">onGetPhoneNumber</span>(<span class=\"hljs-params\">event</span>)&#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(event);<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n<p>返回结果：</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs text\">currentTarget: &#123;id: &quot;&quot;, offsetLeft: 68, offsetTop: 0, dataset: &#123;…&#125;&#125;<br>detail: &#123;errMsg: &quot;getPhoneNumber:ok&quot;, encryptedData: &quot;bF9O8dTHdbGpKsdEj6tgnhHIUa4xxf8GKDhyyqc9/OUweu/yyp…brupo5Pzr9zNICoJlcm8q6iA3azjDeDhRnlSG4np/soDaxQ==&quot;, iv: &quot;TuJRVFz2q0PoCilZZfet6Q==&quot;&#125;<br>mark: &#123;&#125;<br>mut: false<br>target: &#123;id: &quot;&quot;, offsetLeft: 68, offsetTop: 0, dataset: &#123;…&#125;&#125;<br>timeStamp: 28140<br>type: &quot;getphonenumber&quot;<br>_userTap: false<br></code></pre></td></tr></table></figure>\n<p>!&gt; 注意点：获取手机号的微信开发者账号必须进行认证，如果没有认证是没有权限进行获取的，认证形式我这里不提供，自行问度娘</p>\n<ul>\n<li>从基础库 <code>2.21.2</code> 开始，获取手机号的文档和方式发生了改变，所以在获取之前先确定自己使用的基础库版本</li>\n</ul>\n<p>居然说到要后端配后，假如我们这里不会 golang，java，nodejs，那不是很蛋疼了，这里就不得不给大家介绍一个工具了，名为 <code>showdoc</code>，官方文档：<a href=\"https://www.showdoc.com.cn/runapi/30291\" target=\"_blank\">https://www.showdoc.com.cn/runapi/30291</a></p>\n<p>更改基础库的版本 &gt;= 2.21.2 (这一步自行解决)：</p>\n<p>需要将 button 组件 open-type 的值设置为 getPhoneNumber，当用户点击并同意之后，可以通过 bindgetphonenumber 事件回调获取到动态令牌code，然后把code传到开发者后台，并在开发者后台调用微信后台提供的 <a href=\"https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/user-info/phone-number/getPhoneNumber.html\" target=\"_blank\">phonenumber.getPhoneNumber</a> 接口，消费code来换取用户手机号。每个code有效期为5分钟，且只能消费一次。</p>\n<p>注：getPhoneNumber 返回的 code 与 wx.login 返回的 code 作用是不一样的，不能混用。</p>\n<p>好了，看了这么多我们直接来上代码走一个：</p>\n<p>获取 <code>code</code>：</p>\n<p>index.wxml:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">open-type</span>=<span class=\"hljs-string\">&quot;getPhoneNumber&quot;</span> <span class=\"hljs-attr\">bindgetphonenumber</span>=<span class=\"hljs-string\">&quot;onGetPhoneNumber&quot;</span>&gt;</span>获取用户手机号<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<p>index.js:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-title class_\">Page</span>(&#123;<br>  <span class=\"hljs-title function_\">onGetPhoneNumber</span>(<span class=\"hljs-params\">event</span>)&#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(event.<span class=\"hljs-property\">detail</span>.<span class=\"hljs-property\">code</span>);<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n<p>获取 AccessToken，官方文档：<a href=\"https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/mp-access-token/getAccessToken.html\" target=\"_blank\">https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/mp-access-token/getAccessToken.html</a></p>\n<p>我们可以使用 showdoc 来进行获取，后续就是通过后端代码进行获取即可：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202304/2105804-20230423171354047-288526347.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>appid, secret 在微信小程序的，开发管理，开发设置当中获取。</p>\n<p>这个时候我们已经有了 accessToken 与 code，然后再拿着这两个数值去调用获取手机号接口(也是通过showdoc进行模拟)需要注意的是code是放在请求体当中的，accessToken 是放在 Query 当中的：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202304/2105804-20230423171620788-1019369126.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202304/2105804-20230423171723269-138423115.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n","prev":{"title":"微信小程序-image组件","link":"2023/04/23/Web/微信小程序/component/常用组件/36-微信小程序-image组件"},"next":{"title":"微信小程序-icon组件","link":"2023/04/22/Web/微信小程序/component/常用组件/34-微信小程序-icon组件"},"plink":"http://example.com/2023/04/22/Web/微信小程序/component/常用组件/35-微信小程序-button组件/","toc":[{"id":"button","title":"button","index":"1"},{"id":"属性","title":"属性","index":"2","children":[{"id":"size","title":"size","index":"2.1"},{"id":"type","title":"type","index":"2.2"},{"id":"plain","title":"plain","index":"2.3"},{"id":"disabled","title":"disabled","index":"2.4"},{"id":"loading","title":"loading","index":"2.5"},{"id":"open-type","title":"open-type","index":"2.6","children":[{"id":"获取用户信息","title":"获取用户信息","index":"2.6.1"},{"id":"获取用户手机号","title":"获取用户手机号","index":"2.6.2"}]}]}],"reading_time":"1360 words in 9 min"}