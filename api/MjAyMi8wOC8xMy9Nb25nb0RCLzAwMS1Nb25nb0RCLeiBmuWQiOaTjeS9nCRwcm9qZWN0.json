{"title":"MongoDB-聚合操作$project","date":"2022-08-13T13:58:10.000Z","date_formatted":{"ll":"Aug 13, 2022","L":"08/13/2022","MM-DD":"08-13"},"link":"2022/08/13/MongoDB/001-MongoDB-聚合操作$project","tags":["MongoDB"],"updated":"2022-08-14T04:49:29.458Z","content":"<h1 id=\"什么是聚合操作\">什么是聚合操作<a title=\"#什么是聚合操作\" href=\"#什么是聚合操作\"></a></h1>\n<ul>\n<li>聚合操作就是通过一个方法完成一系列的操作</li>\n<li>在聚合操作中, 每一个操作我们称之为一个阶段</li>\n<li>聚合操作会将上一个阶段处理结果传给下一个阶段继续处理</li>\n<li>所有阶段都处理完毕会返回一个新的结果集给我们</li>\n</ul>\n<h1 id=\"聚合操作格式\">聚合操作格式<a title=\"#聚合操作格式\" href=\"#聚合操作格式\"></a></h1>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">db.&lt;collection&gt;.aggregate(&lt;pipeline&gt;, &lt;options&gt;)<br></code></pre></td></tr></table></figure>\n<ul>\n<li><code>&lt;pipeline&gt;</code>: 定义每个阶段操作</li>\n<li><code>&lt;options&gt;</code>: 聚合操作额外配置</li>\n</ul>\n<h1 id=\"聚合管道阶段\">聚合管道阶段<a title=\"#聚合管道阶段\" href=\"#聚合管道阶段\"></a></h1>\n<blockquote>\n<p>可以利用，<code>$project</code> 对输入文档进行再次投影</p>\n</blockquote>\n<ul>\n<li>作用: 按照我们需要的格式生成结果集</li>\n<li>格式: <code>&#123;$project:&#123;&lt;field&gt;:&lt;value&gt;&#125;&#125;</code></li>\n</ul>\n<p>好了介绍了这么多我们来看示例吧，首先添加测试数据如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">db.person.insert([<br>    &#123;name:&#123;firstName:<span class=\"hljs-string\">&#x27;Jonathan&#x27;</span>, lastName:<span class=\"hljs-string\">&#x27;Lee&#x27;</span>&#125;, age:18, book:&#123;name:<span class=\"hljs-string\">&#x27;玩转HTML&#x27;</span>, price: 88&#125;&#125;,<br>    &#123;name:&#123;firstName:<span class=\"hljs-string\">&#x27;Amelie&#x27;</span>, lastName:<span class=\"hljs-string\">&#x27;BNTang&#x27;</span>&#125;, age:17, book:&#123;name:<span class=\"hljs-string\">&#x27;玩转JavaScript&#x27;</span>, price: 99&#125;&#125;<br>]);<br><br>db.person.find();<br></code></pre></td></tr></table></figure>\n<p>关于 @project：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">db.person.aggregate([<br>    &#123;<br>        <span class=\"hljs-variable\">$project</span>:&#123;<br>            _id:0,<br>            clientName: <span class=\"hljs-string\">&#x27;$name.firstName&#x27;</span>,<br>            clientAge: <span class=\"hljs-string\">&#x27;$age&#x27;</span><br>        &#125;<br>    &#125;<br>]);<br></code></pre></td></tr></table></figure>\n<h1 id=\"聚合表达式\">聚合表达式<a title=\"#聚合表达式\" href=\"#聚合表达式\"></a></h1>\n<blockquote>\n<p>字段路径表达式</p>\n</blockquote>\n<ul>\n<li><code>$&lt;filed&gt;</code>: 使用 <code>$</code> 来指示字段路径</li>\n<li><code>$&lt;filed&gt;.&lt;sub-field&gt;</code>: 使用 <code>$</code> 和 <code>.</code> 来指示内嵌文档字段路径</li>\n</ul>\n<blockquote>\n<p>字段路径表达式示例</p>\n</blockquote>\n<ul>\n<li>$name</li>\n<li>$<a href=\"http://book.name\">book.name</a></li>\n</ul>\n<h1 id=\"注意点\">注意点<a title=\"#注意点\" href=\"#注意点\"></a></h1>\n<blockquote>\n<p>$project 修改的是结果集而不是原有的集合</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">db.person.aggregate([<br>    &#123;<br>        <span class=\"hljs-variable\">$project</span>:&#123;<br>            _id:0,<br>            myName: <span class=\"hljs-string\">&#x27;$name.lastName&#x27;</span><br>        &#125;<br>    &#125;<br>]);<br><br>db.person.find();<br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>如果在 @project 聚合操作中使用了原有文档不存在的字段, 那么会自动用 <code>Null</code> 来填充<br>\n<code>_id: 0</code> 的含义就是说 _id 这个字段不展示，可以告诉它那些字段需要显示那些字段不需要显示</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">db.person.aggregate([<br>    &#123;<br>        <span class=\"hljs-variable\">$project</span>:&#123;<br>            _id:0,<br>            fullName: [<span class=\"hljs-string\">&#x27;$name.firstName&#x27;</span>, <span class=\"hljs-string\">&#x27;$name.middleName&#x27;</span>,<span class=\"hljs-string\">&#x27;$name.lastName&#x27;</span>],<br>            clientAge: <span class=\"hljs-string\">&#x27;$age&#x27;</span><br>        &#125;<br>    &#125;<br>]);<br></code></pre></td></tr></table></figure>\n<p><img src=\"/2022/08/13/MongoDB/001-MongoDB-%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C$project/img.png\" alt=\"img.png\" loading=\"lazy\" class=\"φbp\"></p>\n","prev":{"title":"MongoDB-数据类型转换操作符","link":"2022/08/14/MongoDB/05-MongoDB-数据类型转换操作符"},"next":{"title":"MongoDB-聚合操作表达式","link":"2022/08/13/MongoDB/04-MongoDB-聚合操作表达式"},"plink":"http://example.com/2022/08/13/MongoDB/001-MongoDB-聚合操作$project/","toc":[{"id":"什么是聚合操作","title":"什么是聚合操作","index":"1"},{"id":"聚合操作格式","title":"聚合操作格式","index":"2"},{"id":"聚合管道阶段","title":"聚合管道阶段","index":"3"},{"id":"聚合表达式","title":"聚合表达式","index":"4"},{"id":"注意点","title":"注意点","index":"5"}],"reading_time":"465 words in 3 min"}