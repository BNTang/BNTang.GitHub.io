{"title":"Mongoose-更新和删除","date":"2022-09-12T01:37:50.000Z","date_formatted":{"ll":"Sep 12, 2022","L":"09/12/2022","MM-DD":"09-12"},"link":"2022/09/12/MongoDB/mongoose/03-Mongoose-更新和删除","tags":["MongoDB"],"updated":"2022-09-12T01:48:05.192Z","content":"<p>本文是紧接着 Mongoose 的增加与查询的下集，所以在这里废话不多说直接上内容。</p>\n<h1 id=\"修改\">修改<a title=\"#修改\" href=\"#修改\"></a></h1>\n<p>根据条件更改：</p>\n<ul>\n<li>第一个参数：需要更新的条件</li>\n<li>第二个参数：更新的内容</li>\n<li>第三个参数：更新的结果返回值</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-title class_\">User</span>.<span class=\"hljs-title function_\">update</span>(&#123;<span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;ls&#x27;</span>&#125;, &#123;<span class=\"hljs-attr\">$set</span>: &#123;<span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">888</span>&#125;&#125;, <span class=\"hljs-function\">(<span class=\"hljs-params\">err, docs</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (!err) &#123;<br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;更新成功&#x27;</span>);<br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(docs);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>\n<p>根据条件修改(带额外配置)：</p>\n<ul>\n<li>第一个参数：需要更新的条件</li>\n<li>第二个参数：更新的内容</li>\n<li>第三个参数：更新的额外配置</li>\n<li>第四个参数：更新的结果</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-title class_\">User</span>.<span class=\"hljs-title function_\">update</span>(&#123;<span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;ls&#x27;</span>&#125;, &#123;<span class=\"hljs-attr\">$set</span>: &#123;<span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">888</span>&#125;&#125;, &#123;<span class=\"hljs-attr\">multi</span>: <span class=\"hljs-literal\">true</span>&#125;, <span class=\"hljs-function\">(<span class=\"hljs-params\">err, docs</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (!err) &#123;<br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;更新成功&#x27;</span>);<br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(docs);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>\n<p>根据条件修改(Promise)：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\">(<span class=\"hljs-keyword\">async</span> () =&gt; &#123;<br>    <span class=\"hljs-keyword\">let</span> result = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title class_\">User</span>.<span class=\"hljs-title function_\">update</span>(&#123;<span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;ls&#x27;</span>&#125;, &#123;<span class=\"hljs-attr\">$set</span>: &#123;<span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">123</span>&#125;&#125;, &#123;<span class=\"hljs-attr\">multi</span>: <span class=\"hljs-literal\">true</span>&#125;);<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(result);<br>&#125;)();<br></code></pre></td></tr></table></figure>\n<h1 id=\"删除\">删除<a title=\"#删除\" href=\"#删除\"></a></h1>\n<p>根据条件删除：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-title class_\">User</span>.<span class=\"hljs-title function_\">remove</span>(&#123;<span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;ww&#x27;</span>&#125;, &#123;&#125;, <span class=\"hljs-function\">(<span class=\"hljs-params\">err, docs</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (!err) &#123;<br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;删除成功&#x27;</span>);<br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(docs);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>\n<p>根据条件删除(只删除满足条件的一条)：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-title class_\">User</span>.<span class=\"hljs-title function_\">deleteOne</span>(&#123;<span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;BNTang&#x27;</span>&#125;, <span class=\"hljs-function\">(<span class=\"hljs-params\">err, docs</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (!err) &#123;<br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;删除成功&#x27;</span>);<br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(docs);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>\n<p>根据条件删除(只删除满足条件的一条,Promise)：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\">(<span class=\"hljs-keyword\">async</span> () =&gt; &#123;<br>    <span class=\"hljs-keyword\">let</span> result = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title class_\">User</span>.<span class=\"hljs-title function_\">deleteOne</span>(&#123;<span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;BNTang&#x27;</span>&#125;);<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(result);<br>&#125;)();<br></code></pre></td></tr></table></figure>","prev":{"title":"MongoDB-复制集开篇","link":"2022/09/12/MongoDB/MongoDB-复制集/01-MongoDB-复制集开篇"},"next":{"title":"Mongoose-增加和查询","link":"2022/09/11/MongoDB/mongoose/02-Mongoose-增加和查询"},"plink":"http://example.com/2022/09/12/MongoDB/mongoose/03-Mongoose-更新和删除/","toc":[{"id":"修改","title":"修改","index":"1"},{"id":"删除","title":"删除","index":"2"}],"reading_time":"312 words in 2 min"}