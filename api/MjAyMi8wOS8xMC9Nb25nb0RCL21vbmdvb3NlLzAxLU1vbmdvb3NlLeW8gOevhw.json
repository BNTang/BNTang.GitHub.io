{"title":"Mongoose-开篇","date":"2022-09-10T12:37:20.000Z","date_formatted":{"ll":"Sep 10, 2022","L":"09/10/2022","MM-DD":"09-10"},"link":"2022/09/10/MongoDB/mongoose/01-Mongoose-开篇","tags":["MongoDB"],"updated":"2022-09-10T12:49:24.562Z","content":"<h1 id=\"mongoose-概述\">Mongoose 概述<a title=\"#mongoose-概述\" href=\"#mongoose-概述\"></a></h1>\n<ul>\n<li>Mongoose和MySQL的Sequelize一样, 都是NodeJS中操作数据库的对象模型工具</li>\n<li>Mongoose使用面向对象的思想对原生的mongoDB命令进行了封装</li>\n</ul>\n<p>?&gt; 官方文档:</p>\n<ul>\n<li><a href=\"http://www.mongoosejs.net/\" target=\"_blank\">http://www.mongoosejs.net/</a></li>\n<li><a href=\"https://mongoosejs.com/\" target=\"_blank\">https://mongoosejs.com/</a></li>\n</ul>\n<h1 id=\"mongoose-和-mongodb-映射关系\">Mongoose 和 MongoDB 映射关系<a title=\"#mongoose-和-mongodb-映射关系\" href=\"#mongoose-和-mongodb-映射关系\"></a></h1>\n<ul>\n<li>在Mongoose中JS中的一个模型就对应数据库中的一个集合</li>\n<li>在Mongoose中JS中的一个对象就对应集合中的一个文档</li>\n<li>在Mongoose中JS中的一个对象的属性就对应文档的一个字段</li>\n</ul>\n<h1 id=\"使用-mongoose\">使用 Mongoose<a title=\"#使用-mongoose\" href=\"#使用-mongoose\"></a></h1>\n<p>安装 Mongoose 在安装之前需要一个 NodeJS 的环境自行搭建：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">npm install mongoose --save<br></code></pre></td></tr></table></figure>\n<p>导入 mongoose:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">const</span> mongoose = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;mongoose&#x27;</span>);<br></code></pre></td></tr></table></figure>\n<p>利用mongoose链接MongoDB服务器 (mongodb://MongoDB服务器IP地址:MongoDB服务器端口号/需要打开的数据库名称):</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\">mongoose.<span class=\"hljs-title function_\">connect</span>(<span class=\"hljs-string\">&#x27;mongodb://127.0.0.1:27017/it6666&#x27;</span>);<br></code></pre></td></tr></table></figure>\n<p>监听链接成功还是失败:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">const</span> db = mongoose.<span class=\"hljs-property\">connection</span>;<br>db.<span class=\"hljs-title function_\">on</span>(<span class=\"hljs-string\">&#x27;error&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">err</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(err, <span class=\"hljs-string\">&#x27;连接失败&#x27;</span>);<br>&#125;);<br>db.<span class=\"hljs-title function_\">once</span>(<span class=\"hljs-string\">&#x27;open&#x27;</span>, <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;连接成功&#x27;</span>);<br>&#125;);<br>db.<span class=\"hljs-title function_\">once</span>(<span class=\"hljs-string\">&#x27;close&#x27;</span>, <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;断开连接&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>\n<p>定义集合中存储数据规则:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">const</span> userSchema = <span class=\"hljs-keyword\">new</span> mongoose.<span class=\"hljs-title class_\">Schema</span>(&#123;<br>    <span class=\"hljs-attr\">name</span>: <span class=\"hljs-title class_\">String</span>,<br>    <span class=\"hljs-attr\">age</span>: <span class=\"hljs-title class_\">Number</span><br>&#125;);<br></code></pre></td></tr></table></figure>\n<p>利用规则创建集合:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">User</span> = mongoose.<span class=\"hljs-title function_\">model</span>(<span class=\"hljs-string\">&#x27;User&#x27;</span>, userSchema);<br></code></pre></td></tr></table></figure>\n<p>!&gt; 只要创建好了模型, 那么以后就可以使用模型来操作这个集合</p>\n<p>!&gt; mongoose会自动将我们指定的集合名称变成复数(s)</p>\n<p>利用集合创建文档:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">const</span> u = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">User</span>(&#123;<span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;zs&#x27;</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">18</span>&#125;);<br></code></pre></td></tr></table></figure>\n<p>!&gt; 只要创建好了对象, 那么以后就可以使用对象来操作文档</p>\n<p>?&gt; 操作文档:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\">u.<span class=\"hljs-title function_\">save</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">err, product</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (!err) &#123;<br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;文档保存成功&#x27;</span>);<br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(product);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>","prev":{"title":"Mongoose-增加和查询","link":"2022/09/11/MongoDB/mongoose/02-Mongoose-增加和查询"},"next":{"title":"MongoDB-树形结构","link":"2022/09/10/MongoDB/索引/MongoDB4.x-数据模型/05-MongoDB-树形结构"},"plink":"http://example.com/2022/09/10/MongoDB/mongoose/01-Mongoose-开篇/","toc":[{"id":"mongoose-概述","title":"Mongoose 概述","index":"1"},{"id":"mongoose-和-mongodb-映射关系","title":"Mongoose 和 MongoDB 映射关系","index":"2"},{"id":"使用-mongoose","title":"使用 Mongoose","index":"3"}],"reading_time":"419 words in 3 min"}