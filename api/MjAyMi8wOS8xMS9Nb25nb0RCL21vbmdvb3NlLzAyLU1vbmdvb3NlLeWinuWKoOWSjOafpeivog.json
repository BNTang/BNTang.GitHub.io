{"title":"Mongoose-增加和查询","date":"2022-09-11T09:20:29.000Z","date_formatted":{"ll":"Sep 11, 2022","L":"09/11/2022","MM-DD":"09-11"},"link":"2022/09/11/MongoDB/mongoose/02-Mongoose-增加和查询","tags":["MongoDB"],"updated":"2022-09-11T09:29:36.097Z","content":"<p>本文的内容是基于 Mongoose 开篇继续延续的，需要将 mongoose 的环境搭建好，我这里就直接上的是进行操作 MongoDB 的代码。</p>\n<h1 id=\"增加\">增加<a title=\"#增加\" href=\"#增加\"></a></h1>\n<p>单个增加：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-title class_\">User</span>.<span class=\"hljs-title function_\">create</span>(&#123;<span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;test666&#x27;</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">666</span>&#125;, <span class=\"hljs-function\">(<span class=\"hljs-params\">err, result</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (!err) &#123;<br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;插入成功&#x27;</span>);<br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(result);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>\n<p>批量增加：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-title class_\">User</span>.<span class=\"hljs-title function_\">create</span>([<br>        &#123;<span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;ls&#x27;</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">18</span>&#125;,<br>        &#123;<span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;ls&#x27;</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">22</span>&#125;,<br>        &#123;<span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;ww&#x27;</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">21</span>&#125;,<br>        &#123;<span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;zl&#x27;</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">23</span>&#125;,<br>        &#123;<span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;BNTang&#x27;</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">33</span>&#125;,<br>    ],<br>    <span class=\"hljs-function\">(<span class=\"hljs-params\">err, result</span>) =&gt;</span> &#123;<br>        <span class=\"hljs-keyword\">if</span> (!err) &#123;<br>            <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&#x27;插入成功&#x27;</span>);<br>            <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(result);<br>        &#125;<br>    &#125;);<br></code></pre></td></tr></table></figure>\n<p>批量增加(Promise的方式)：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\">(<span class=\"hljs-keyword\">async</span> () =&gt; &#123;<br>    <span class=\"hljs-keyword\">let</span> result = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title class_\">User</span>.<span class=\"hljs-title function_\">create</span>([<br>        &#123;<span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;ls&#x27;</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">18</span>&#125;,<br>        &#123;<span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;ls&#x27;</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">22</span>&#125;,<br>        &#123;<span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;ww&#x27;</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">21</span>&#125;,<br>        &#123;<span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;zl&#x27;</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">23</span>&#125;,<br>        &#123;<span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;BNTang&#x27;</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">33</span>&#125;,<br>    ]);<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(result);<br>&#125;)();<br></code></pre></td></tr></table></figure>\n<h1 id=\"查询\">查询<a title=\"#查询\" href=\"#查询\"></a></h1>\n<p>全查询（全字段全数据）：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-title class_\">User</span>.<span class=\"hljs-title function_\">find</span>(&#123;&#125;, &#123;&#125;, <span class=\"hljs-function\">(<span class=\"hljs-params\">err, docs</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (!err) &#123;<br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(docs);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>\n<p>全查询（只展示指定字段）：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-title class_\">User</span>.<span class=\"hljs-title function_\">find</span>(&#123;&#125;, &#123;<span class=\"hljs-attr\">_id</span>: <span class=\"hljs-number\">0</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">1</span>&#125;, <span class=\"hljs-function\">(<span class=\"hljs-params\">err, docs</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (!err) &#123;<br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(docs);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>\n<p>根据条件查询指定条件的数据：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-title class_\">User</span>.<span class=\"hljs-title function_\">find</span>(&#123;<span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;BNTang&#x27;</span>&#125;, &#123;<span class=\"hljs-attr\">_id</span>: <span class=\"hljs-number\">0</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">1</span>&#125;, <span class=\"hljs-function\">(<span class=\"hljs-params\">err, docs</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (!err) &#123;<br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(docs);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>\n<p>分页查询：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-title class_\">User</span>.<span class=\"hljs-title function_\">find</span>(&#123;&#125;, &#123;<span class=\"hljs-attr\">_id</span>: <span class=\"hljs-number\">0</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">1</span>&#125;, &#123;<span class=\"hljs-attr\">skip</span>: <span class=\"hljs-number\">5</span>, <span class=\"hljs-attr\">limit</span>: <span class=\"hljs-number\">5</span>&#125;, <span class=\"hljs-function\">(<span class=\"hljs-params\">err, docs</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (!err) &#123;<br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(docs);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>\n<p>分页查询(Promise)：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\">(<span class=\"hljs-keyword\">async</span> () =&gt; &#123;<br>    <span class=\"hljs-keyword\">let</span> result = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title class_\">User</span>.<span class=\"hljs-title function_\">find</span>(&#123;&#125;, &#123;<span class=\"hljs-attr\">_id</span>: <span class=\"hljs-number\">0</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">1</span>&#125;, &#123;<span class=\"hljs-attr\">skip</span>: <span class=\"hljs-number\">5</span>, <span class=\"hljs-attr\">limit</span>: <span class=\"hljs-number\">5</span>&#125;);<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(result);<br>&#125;)();<br></code></pre></td></tr></table></figure>","prev":{"title":"Mongoose-更新和删除","link":"2022/09/12/MongoDB/mongoose/03-Mongoose-更新和删除"},"next":{"title":"Mongoose-开篇","link":"2022/09/10/MongoDB/mongoose/01-Mongoose-开篇"},"plink":"http://example.com/2022/09/11/MongoDB/mongoose/02-Mongoose-增加和查询/","toc":[{"id":"增加","title":"增加","index":"1"},{"id":"查询","title":"查询","index":"2"}],"reading_time":"319 words in 2 min"}