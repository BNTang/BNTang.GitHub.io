{"title":"虚拟IP绑定公网IP访问","date":"2023-07-09T03:24:55.000Z","date_formatted":{"ll":"Jul 9, 2023","L":"07/09/2023","MM-DD":"07-09"},"link":"2023/07/09/DevOps与云原生/Keepalive+Haproxy 高可用搭建/07-虚拟IP绑定公网IP访问","tags":["Keepalive+Haproxy 高可用搭建"],"updated":"2023-07-09T05:04:03.473Z","content":"<h1 id=\"绑定公网-ip\">绑定公网 IP<a title=\"#绑定公网-ip\" href=\"#绑定公网-ip\"></a></h1>\n<p>我们目前的虚拟 IP，还不能通过公网的形式进行访问，我们首先，来使用内部的 IP 进行访问看看效果如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">curl 虚拟IP<br></code></pre></td></tr></table></figure>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202307/2105804-20230709120000606-1228401397.png\" alt=\"image-20230709115959651\" loading=\"lazy\" class=\"φbp\"></p>\n<p>如上图我访问了两次，第一次访问返回的是 2222 的 nginx，第二次访问是 1111 的 nginx，已经实现最开始的架构图当中的效果了。</p>\n<p>现在要解决的问题就是让我们可以通过公网 IP 进行访问虚拟 IP，在通过 Keepalive 来分发到对应的 Haproxy 中找到对应提供服务的 nginx 呈现给用户使用。</p>\n<p>首先我们去华为云当中解绑一台服务器的公网 IP，拿出来给我们的虚拟 IP 使用，解绑方式如下图：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202307/2105804-20230709121821038-1746805951.png\" alt=\"image-20230709121819852\" loading=\"lazy\" class=\"φbp\"></p>\n<p>解绑完毕之后，我们去到我们虚拟 IP 的页面进入方式如下：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202307/2105804-20230709121911631-2138148765.png\" alt=\"image-20230709121911000\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202307/2105804-20230709121934628-421854967.png\" alt=\"image-20230709121933904\" loading=\"lazy\" class=\"φbp\"></p>\n<p>然后找到我们虚拟 IP 点击绑定弹性公网 IP，即可：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202307/2105804-20230709121959438-304301554.png\" alt=\"image-20230709121958677\" loading=\"lazy\" class=\"φbp\"></p>\n<p>紧接着去浏览器输入我们的公网IP，<a href=\"http://xn--IP-xz4cq45o/%EF%BC%8C%E6%95%88%E6%9E%9C%E5%A6%82%E4%B8%8B%E5%9B%BE%E6%89%80%E7%A4%BA%EF%BC%9A\" target=\"_blank\">http://公网IP/，效果如下图所示：</a></p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202307/2105804-20230709124240623-586305469.png\" alt=\"image-20230709124239591\" loading=\"lazy\" class=\"φbp\"></p>\n<p>接下来就是做测试了，我们将 nginx 是 2222 的机器关机，看看是不是我们无论如何访问都是返回 1111：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202307/2105804-20230709124842751-1860139854.png\" alt=\"image-20230709124841816\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202307/2105804-20230709124850961-258034418.png\" alt=\"image-20230709124850326\" loading=\"lazy\" class=\"φbp\"></p>\n<p>在测试下，我们开机了之后会不会自动恢复轮询：</p>\n<p>开机：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202307/2105804-20230709124959370-458355388.png\" alt=\"image-20230709124958541\" loading=\"lazy\" class=\"φbp\"></p>\n<p>已恢复：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202307/2105804-20230709125007868-1294831011.png\" alt=\"image-20230709125007242\" loading=\"lazy\" class=\"φbp\"></p>\n<h1 id=\"释放服务器资源\">释放服务器资源<a title=\"#释放服务器资源\" href=\"#释放服务器资源\"></a></h1>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202307/2105804-20230709125922268-666508202.png\" alt=\"image-20230709125921433\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202307/2105804-20230709125956261-1846417805.png\" alt=\"image-20230709125955491\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202307/2105804-20230709130158294-2107372355.png\" alt=\"image-20230709130157530\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202307/2105804-20230709130217038-67966417.png\" alt=\"image-20230709130216313\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202307/2105804-20230709130230836-1146831768.png\" alt=\"image-20230709130230205\" loading=\"lazy\" class=\"φbp\"></p>\n<p>到此为止，这一节我们就看到这里，这个系列已经更新完毕。</p>\n","prev":{"title":"Haproxy-安装与配置","link":"2023/07/09/DevOps与云原生/Keepalive+Haproxy 高可用搭建/06-Haproxy-安装与配置"},"next":{"title":"TienChin 验证码响应结果分析&验证码生成接口分析","link":"2023/06/22/项目/TienChin 健身系统/2023-6-11/04-TienChin 验证码响应结果分析&验证码生成接口分析"},"plink":"http://example.com/2023/07/09/DevOps与云原生/Keepalive+Haproxy 高可用搭建/07-虚拟IP绑定公网IP访问/","toc":[{"id":"绑定公网-ip","title":"绑定公网 IP","index":"1"},{"id":"释放服务器资源","title":"释放服务器资源","index":"2"}],"reading_time":"556 words in 4 min"}