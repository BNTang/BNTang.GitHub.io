{"title":"Haproxy-安装与配置","date":"2023-07-09T03:24:55.000Z","date_formatted":{"ll":"Jul 9, 2023","L":"07/09/2023","MM-DD":"07-09"},"link":"2023/07/09/DevOps与云原生/Keepalive+Haproxy 高可用搭建/06-Haproxy-安装与配置","tags":["Keepalive+Haproxy 高可用搭建"],"updated":"2023-07-09T04:57:13.828Z","content":"<h1 id=\"安装-haproxy\">安装 Haproxy<a title=\"#安装-haproxy\" href=\"#安装-haproxy\"></a></h1>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">apt -y install haproxy<br></code></pre></td></tr></table></figure>\n<h1 id=\"环境配置\">环境配置<a title=\"#环境配置\" href=\"#环境配置\"></a></h1>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-built_in\">cat</span> &gt;&gt; /etc/sysctl.conf &lt;&lt;<span class=\"hljs-string\">EOF</span><br><span class=\"hljs-string\">net.ipv4.ip_nonlocal_bind = 1</span><br><span class=\"hljs-string\">EOF</span><br></code></pre></td></tr></table></figure>\n<p>查看是否已经配置好，内核参数生效：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sysctl -p<br></code></pre></td></tr></table></figure>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202307/2105804-20230709114905579-166294772.png\" alt=\"image-20230709114904635\" loading=\"lazy\" class=\"φbp\"></p>\n<h1 id=\"添加-haproxy-配置\">添加 Haproxy 配置<a title=\"#添加-haproxy-配置\" href=\"#添加-haproxy-配置\"></a></h1>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-built_in\">cat</span> &gt;&gt; /etc/haproxy/haproxy.cfg &lt;&lt;<span class=\"hljs-string\">EOF</span><br><span class=\"hljs-string\">listen stats</span><br><span class=\"hljs-string\">   mode http</span><br><span class=\"hljs-string\">   bind 0.0.0.0:8888</span><br><span class=\"hljs-string\">   stats enable</span><br><span class=\"hljs-string\">   log global</span><br><span class=\"hljs-string\">   stats uri /status</span><br><span class=\"hljs-string\">   stats auth admin:123456</span><br><span class=\"hljs-string\"></span><br><span class=\"hljs-string\">listen web-nginx</span><br><span class=\"hljs-string\">   bind 192.168.0.101:80</span><br><span class=\"hljs-string\">   mode http</span><br><span class=\"hljs-string\">   option forwardfor</span><br><span class=\"hljs-string\">   balance roundrobin</span><br><span class=\"hljs-string\">   server nginx01 192.168.0.89:8088 check inter 3s fall 3 rise 3</span><br><span class=\"hljs-string\">   server nginx02 192.168.0.149:8088 check inter 3s fall 3 rise 3</span><br><span class=\"hljs-string\">EOF</span><br></code></pre></td></tr></table></figure>\n<p>重启 Haproxy：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">systemctl restart haproxy<br></code></pre></td></tr></table></figure>\n<ul>\n<li><code>listen stats</code>：配置的内容是 Haproxy 图形化界面的信息，待会我们去浏览器输入 IP:8888, 需要输入我们配置好的用户名与密码才可以访问到我们的 Haproxy 图形化界面</li>\n<li>stats uri: Haproxy 图形化界面访问的 URL</li>\n<li>stats auth：Haproxy 图形化界面访问的授权信息</li>\n<li>listen web-nginx：绑定的就是我们两台机器当中的 Nginx 信息，bind 192.168.0.101:80 是虚拟 IP，是之前申请下来的虚拟 IP</li>\n</ul>\n<p>浏览器输入 IP:8888, 查看是否安装成功：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202307/2105804-20230709115020895-1999091183.png\" alt=\"image-20230709115020149\" loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202307/2105804-20230709115031098-2039084065.png\" alt=\"image-20230709115030456\" loading=\"lazy\" class=\"φbp\"></p>\n","prev":{"title":"建表与数据准备","link":"2023/07/15/MySQL/SQL 训练/01-建表与数据准备"},"next":{"title":"虚拟IP绑定公网IP访问","link":"2023/07/09/DevOps与云原生/Keepalive+Haproxy 高可用搭建/07-虚拟IP绑定公网IP访问"},"plink":"http://example.com/2023/07/09/DevOps与云原生/Keepalive+Haproxy 高可用搭建/06-Haproxy-安装与配置/","toc":[{"id":"安装-haproxy","title":"安装 Haproxy","index":"1"},{"id":"环境配置","title":"环境配置","index":"2"},{"id":"添加-haproxy-配置","title":"添加 Haproxy 配置","index":"3"}],"reading_time":"325 words in 2 min"}