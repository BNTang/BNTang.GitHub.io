{"title":"MongoDB-聚合操作$group","date":"2022-08-13T10:18:35.000Z","date_formatted":{"ll":"Aug 13, 2022","L":"08/13/2022","MM-DD":"08-13"},"link":"2022/08/13/MongoDB/01-MongoDB-聚合操作$group","tags":["MongoDB"],"updated":"2022-08-14T08:29:40.562Z","content":"<h1 id=\"聚合管道阶段\">聚合管道阶段<a title=\"#聚合管道阶段\" href=\"#聚合管道阶段\"></a></h1>\n<ul>\n<li><code>$group</code>: 对文档进行分组</li>\n</ul>\n<p>格式：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-punctuation\">&#123;</span>$group<span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>    _id<span class=\"hljs-punctuation\">:</span>&lt;expression&gt;<span class=\"hljs-punctuation\">,</span><br>    &lt;field1&gt;<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span>&lt;accumulator1&gt;<span class=\"hljs-punctuation\">:</span> &lt;expression1&gt;<span class=\"hljs-punctuation\">&#125;</span><br>    ... ...<br><span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">&#125;</span><br></code></pre></td></tr></table></figure>\n<p>group 括号当中属性的含义：</p>\n<ul>\n<li><code>_id</code>: 定义分组规则</li>\n<li><code>&lt;field&gt;</code>: 定义新字段</li>\n</ul>\n<h1 id=\"示例\">示例<a title=\"#示例\" href=\"#示例\"></a></h1>\n<p>添加测试数据，在添加之前先将之前的旧数据进行删除，删除的方式我这里不介绍自行删除，添加测试的数据脚本如下：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.person.insert(<span class=\"hljs-punctuation\">[</span><br>    <span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;zs&#x27;<span class=\"hljs-punctuation\">,</span> age<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">10</span><span class=\"hljs-punctuation\">,</span> city<span class=\"hljs-punctuation\">:</span>&#x27;北京&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;ls&#x27;<span class=\"hljs-punctuation\">,</span> age<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">20</span><span class=\"hljs-punctuation\">,</span> city<span class=\"hljs-punctuation\">:</span>&#x27;上海&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;ww&#x27;<span class=\"hljs-punctuation\">,</span> age<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">30</span><span class=\"hljs-punctuation\">,</span> city<span class=\"hljs-punctuation\">:</span>&#x27;北京&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;zl&#x27;<span class=\"hljs-punctuation\">,</span> age<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">40</span><span class=\"hljs-punctuation\">,</span> city<span class=\"hljs-punctuation\">:</span>&#x27;上海&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;lnj&#x27;<span class=\"hljs-punctuation\">,</span> age<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">50</span><span class=\"hljs-punctuation\">,</span> city<span class=\"hljs-punctuation\">:</span>&#x27;北京&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;jjj&#x27;<span class=\"hljs-punctuation\">,</span> age<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">60</span><span class=\"hljs-punctuation\">,</span> city<span class=\"hljs-punctuation\">:</span>&#x27;广州&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br><span class=\"hljs-punctuation\">]</span>);<br></code></pre></td></tr></table></figure>\n<p>然后就是使用 group：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.person.aggregate(<span class=\"hljs-punctuation\">[</span><br>    <span class=\"hljs-punctuation\">&#123;</span>$group<span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>        _id<span class=\"hljs-punctuation\">:</span> &#x27;$city&#x27;<span class=\"hljs-punctuation\">,</span><br>        totalAge<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span>$sum<span class=\"hljs-punctuation\">:</span>&#x27;$age&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>        avgAge<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span>$avg<span class=\"hljs-punctuation\">:</span>&#x27;$age&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>        minAge<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span>$min<span class=\"hljs-punctuation\">:</span>&#x27;$age&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>        maxAge<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span>$max<span class=\"hljs-punctuation\">:</span>&#x27;$age&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>        totalName<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span>$push<span class=\"hljs-punctuation\">:</span>&#x27;$name&#x27;<span class=\"hljs-punctuation\">&#125;</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">&#125;</span><br><span class=\"hljs-punctuation\">]</span>);<br></code></pre></td></tr></table></figure>","prev":{"title":"MongoDB-聚合操作$out","link":"2022/08/13/MongoDB/02-MongoDB-聚合操作$out"},"next":{"title":"Hexo 图片上传之 hexo-asset-image 路径编译 BUG","link":"2022/08/13/Hexo/02-hexo-asset-image 上传图片编译路径的BUG"},"plink":"http://example.com/2022/08/13/MongoDB/01-MongoDB-聚合操作$group/","toc":[{"id":"聚合管道阶段","title":"聚合管道阶段","index":"1"},{"id":"示例","title":"示例","index":"2"}],"reading_time":"192 words in 1 min"}