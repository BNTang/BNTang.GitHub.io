{"title":"『云函数』快速获取 OpenID","date":"2023-12-03T09:46:02.000Z","date_formatted":{"ll":"Dec 3, 2023","L":"12/03/2023","MM-DD":"12-03"},"link":"2023/12/03/Web/微信小程序/云开发/74-『云函数』快速获取 OpenID","tags":["云开发","微信小程序"],"updated":"2024-01-19T03:14:11.100Z","content":"<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202312/2105804-20231203183951882-1958793464.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>[toc]</p>\n<h1 id=\"1.前言\">1.前言<a title=\"#1.前言\" href=\"#1.前言\"></a></h1>\n<p>好的，经过上一篇文章的介绍，给大家介绍了一下，如何通过云函数，来加工处理数据，那么了解完了通过云函数加工处理数据之后，那么本篇文章其实是来带大家填一个坑，那么填一个什么坑呢？在前面我在介绍云存储的时候，为了避免用户上传相同名称的资源文件，导致后上传的会覆盖先上传的，这个时候我们就需要动态的生成这个文件的名称，而不要让用户去命名这个文件。</p>\n<p>那动态的生成文件名称，我用的是时间戳 + 扩展名的形式，而 openId，那个时候我还不想给大家介绍，因为我想介绍完毕了云函数之后，再来介绍 openId，但是后来我发现，这个 openId，其实是可以在云函数中快速获取的，所以，我就把这个坑给填上了。</p>\n<p>如果没有了解过云函数，这个时候获取 openId 是一件繁琐的事情，但是如果了解过云函数，那么获取 openId 就是一件非常简单的事情，那么接下来，我们就来看看，如何在云函数中快速获取 openId。</p>\n<h1 id=\"2.云函数快速获取-openid\">2.云函数快速获取 openId<a title=\"#2.云函数快速获取-openid\" href=\"#2.云函数快速获取-openid\"></a></h1>\n<p>如果不在与函数中获取 openId，那么获取流程如下(这里我自己画图我省略了，我去网上找了一张图)：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240117073052168-1972358292.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>这个流程是微信授权登录的流程，也就是说，过去你想获取 OpenId，必须要让用户通过微信登录，登录之后，才能去获取到这个用户的 OpenId。</p>\n<p>介绍一下什么是 OpenId：OpenId 是微信为每一个用户生成的唯一标识，这个标识是不会重复的，也就是说，每一个用户的 OpenId 都是不一样的，这个 OpenId 是微信给每一个用户生成的，我们是无法修改的。</p>\n<p>通过如上我贴出来的流程图，我们是不是有好几步要做才能完成这个获取 OpenId, 那么我们能不能简化这个流程呢？答案是肯定的，我们可以通过云函数来快速获取 OpenId，那么我们来看看，如何通过云函数来快速获取 OpenId。</p>\n<p>这里我在新建一个新的云函数，命名为：<code>demo</code>，我告诉你，在你新建完成之后，其实就已经获取到了 OpenId 😁, 然后你找到新建的这个云函数 index.js 文件查看一下，你会发现，这个文件中已经有了一些代码了，如下：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240117073851227-1113090751.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>在上图中，代码的含义首先通过 <code>cloud.getWXContext()</code> 获取到了微信的上下文对象，然后再通过微信上下文对象获取到了一些信息, 获取到的信息中就包含了我们本文要介绍的 OpenId。</p>\n<p>这个时候呢，先不管三七二十一，直接将这个新建的云函数部署到云端，然后在云函数的调试界面，点击调用，然后你会发现，你的 OpenId 已经获取到了，当然也可以通过代码来获取，在页面上编写一个按钮，然后编写对应的事件回调代码，如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;primary&quot;</span> <span class=\"hljs-attr\">bindtap</span>=<span class=\"hljs-string\">&quot;onOpenIdTap&quot;</span>&gt;</span>获取 OpenId<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<p>再编写一下对应的事件回调代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">async</span> <span class=\"hljs-title function_\">onOpenIdTap</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">const</span> res = <span class=\"hljs-keyword\">await</span> wx.<span class=\"hljs-property\">cloud</span>.<span class=\"hljs-title function_\">callFunction</span>(&#123;<br>        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;demo&#x27;</span>,<br>    &#125;);<br><br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res);<br>&#125;<br></code></pre></td></tr></table></figure>\n<p>然后点击按钮，你会发现，OpenId 已经获取到了，如下：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240118071410726-1171846852.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<h1 id=\"3.总结\">3.总结<a title=\"#3.总结\" href=\"#3.总结\"></a></h1>\n<p>到这基本上本文的主要内容就主要介绍完毕了，通过本文你可以了解到如何在云函数中快速获取 OpenId，什么是 OpenId，以及为什么要在云函数中获取 OpenId，而不再微信小程序代码中获取 OpenId。</p>\n<p>本篇文章内容介绍到这就结束了，我们下期再见，感谢大家的观看，谢谢大家。</p>\n<blockquote>\n<ul>\n<li>🐤如果您对本文有任何疑问或想法，请在评论区留言，我将很乐意与您交流。</li>\n<li>🐰您的每一条评论对我都至关重要，我会尽快给予回复。</li>\n<li>🎈如果您觉得这篇文章对您有所启发或帮助，请不吝赞赏、收藏或分享。</li>\n<li>🎁您的每一个动作都是对我创作的最大鼓励和支持。</li>\n<li>👍谢谢您的阅读和陪伴！</li>\n<li>😁如果您觉得本文对您有所帮助，可以关注我的公众号 <code>BNTang</code>，我会不定期分享一些干货文章。</li>\n<li>🍻感谢您的支持，我会继续努力的！</li>\n</ul>\n</blockquote>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202312/2105804-20231211215004818-977875224.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n","prev":{"title":"『云函数』处理数据","link":"2023/12/03/Web/微信小程序/云开发/73-『云函数』处理数据"},"next":{"title":"『云函数』传参和调试","link":"2023/12/03/Web/微信小程序/云开发/72-『云函数』传参和调试"},"plink":"http://example.com/2023/12/03/Web/微信小程序/云开发/74-『云函数』快速获取 OpenID/","toc":[{"id":"1.前言","title":"1.前言","index":"1"},{"id":"2.云函数快速获取-openid","title":"2.云函数快速获取 openId","index":"2"},{"id":"3.总结","title":"3.总结","index":"3"}]}