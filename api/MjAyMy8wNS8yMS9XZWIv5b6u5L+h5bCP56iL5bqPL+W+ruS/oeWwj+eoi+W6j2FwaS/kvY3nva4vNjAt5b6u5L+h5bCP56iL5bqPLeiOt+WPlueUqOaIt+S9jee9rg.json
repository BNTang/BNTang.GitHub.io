{"title":"微信小程序-获取用户位置","date":"2023-05-21T14:38:45.000Z","date_formatted":{"ll":"May 21, 2023","L":"05/21/2023","MM-DD":"05-21"},"link":"2023/05/21/Web/微信小程序/微信小程序api/位置/60-微信小程序-获取用户位置","tags":["微信小程序"],"updated":"2023-05-25T16:09:20.412Z","content":"<p>首先我要提供几个文档的链接地址：</p>\n<p>首先是官方文档的获取用户位置的API文档地址：</p>\n<p>官方文档地址：<a href=\"https://developers.weixin.qq.com/miniprogram/dev/api/location/wx.getLocation.html\" target=\"_blank\">https://developers.weixin.qq.com/miniprogram/dev/api/location/wx.getLocation.html</a></p>\n<p>然后本人根据官方文档的介绍直接去页面编写了一个按钮，并且监听了这个按钮的点击事件，在事件方法当中调用了微信提供的获取用户位置的API，然后发现不好用啊！</p>\n<p>代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs wxml\">&lt;!--index.wxml--&gt;<br>&lt;button bindtap=&quot;getUserLocation&quot;&gt;获取用户位置&lt;/button&gt;<br></code></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-comment\">// index.js</span><br><span class=\"hljs-title class_\">Page</span>(&#123;<br>  <span class=\"hljs-title function_\">getUserLocation</span>(<span class=\"hljs-params\"></span>) &#123;<br>    wx.<span class=\"hljs-title function_\">getLocation</span>(&#123;<br>      success (res) &#123;<br>        <span class=\"hljs-keyword\">const</span> latitude = res.<span class=\"hljs-property\">latitude</span><br>        <span class=\"hljs-keyword\">const</span> longitude = res.<span class=\"hljs-property\">longitude</span><br>        <span class=\"hljs-keyword\">const</span> speed = res.<span class=\"hljs-property\">speed</span><br>        <span class=\"hljs-keyword\">const</span> accuracy = res.<span class=\"hljs-property\">accuracy</span><br>        <br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res);<br>      &#125;<br>     &#125;)<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n<p>点击按钮报如下图的错误：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202305/2105804-20230521230738956-1376963649.png\" alt=\"image-20230521230738435\" loading=\"lazy\" class=\"φbp\"></p>\n<p>然后我点击了查看详情：</p>\n<ul>\n<li><a href=\"https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#permission\" target=\"_blank\">https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#permission</a></li>\n</ul>\n<p>按照文档的提示我在 app.json 添加了 permission，发现已经可以了。</p>\n<p>如果不可以我建议在按照我下图的方式去进行在配置下 app.json：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202305/2105804-20230521230921931-1543673289.png\" alt=\"image-20230521230921372\" loading=\"lazy\" class=\"φbp\"></p>\n<p>文档地址：<a href=\"https://developers.weixin.qq.com/community/develop/doc/000a02f2c5026891650e7f40351c01\" target=\"_blank\">https://developers.weixin.qq.com/community/develop/doc/000a02f2c5026891650e7f40351c01</a></p>\n<h1 id=\"总结\">总结<a title=\"#总结\" href=\"#总结\"></a></h1>\n<p>通过微信 wx.getLocation() API 获取，必须在 app.json 中添加如下配置：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-attr\">&quot;requiredPrivateInfos&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;getLocation&quot;</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span><br><span class=\"hljs-attr\">&quot;permission&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>  <span class=\"hljs-attr\">&quot;scope.userLocation&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>    <span class=\"hljs-attr\">&quot;desc&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;你的位置信息将用于给你推荐小姐姐小哥哥&quot;</span><br>  <span class=\"hljs-punctuation\">&#125;</span><br><span class=\"hljs-punctuation\">&#125;</span><br></code></pre></td></tr></table></figure>","prev":{"title":"微信小程序-Storage","link":"2023/05/21/Web/微信小程序/微信小程序api/数据缓存/59-微信小程序-Storage"},"next":{"title":"微信小程序-常用弹窗","link":"2023/05/21/Web/微信小程序/微信小程序api/界面/交互/58-微信小程序-常用弹窗"},"plink":"http://example.com/2023/05/21/Web/微信小程序/微信小程序api/位置/60-微信小程序-获取用户位置/","toc":[{"id":"总结","title":"总结","index":"1"}],"reading_time":"357 words in 2 min"}