{"title":"微信小程序-Storage","date":"2023-05-21T14:46:30.000Z","date_formatted":{"ll":"May 21, 2023","L":"05/21/2023","MM-DD":"05-21"},"link":"2023/05/21/Web/微信小程序/微信小程序api/数据缓存/59-微信小程序-Storage","tags":["微信小程序"],"updated":"2023-05-28T10:12:12.368Z","content":"<p>官方文档地址：<a href=\"https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.setStorageSync.html\" target=\"_blank\">https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.setStorageSync.html</a></p>\n<p>?&gt; Storage 本地存储，和原生前端开发差不多，单个 Key 允许存储的最大数据长度为 1MB, 所有数据存储上限为 10MB。</p>\n<h1 id=\"存储数据\">存储数据<a title=\"#存储数据\" href=\"#存储数据\"></a></h1>\n<p>?&gt; 带了 Sync 就是同步的方法，没有带就是异步的</p>\n<h1 id=\"setstoragesync/setstorage\">setStorageSync/setStorage<a title=\"#setstoragesync/setstorage\" href=\"#setstoragesync/setstorage\"></a></h1>\n<p>将数据存储在本地缓存中指定的 key 中。会覆盖掉原来该 key 对应的内容。除非用户主动删除或因存储空间原因被系统清理，否则数据都一直可用。单个 key 允许存储的最大数据长度为 1MB，所有数据存储上限为 10MB。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs wxml\">&lt;!--index.wxml--&gt;<br>&lt;text&gt;首页&lt;/text&gt;<br>&lt;button bindtap=&quot;onStorage&quot;&gt;测试 Storage Api&lt;/button&gt;<br></code></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-comment\">// index.js</span><br><span class=\"hljs-title class_\">Page</span>(&#123;<br>  <span class=\"hljs-title function_\">onStorage</span>(<span class=\"hljs-params\"></span>) &#123;<br>    wx.<span class=\"hljs-title function_\">setStorageSync</span>(<span class=\"hljs-string\">&#x27;name&#x27;</span>, <span class=\"hljs-string\">&#x27;BNTang&#x27;</span>)<br>    wx.<span class=\"hljs-title function_\">setStorage</span>(&#123;<br>      <span class=\"hljs-attr\">key</span>: <span class=\"hljs-string\">&#x27;age&#x27;</span>,<br>      <span class=\"hljs-attr\">data</span>: <span class=\"hljs-string\">&#x27;BNTang&#x27;</span>,<br>      <span class=\"hljs-attr\">encrypt</span>: <span class=\"hljs-literal\">true</span>,<br>      <span class=\"hljs-title function_\">success</span>(<span class=\"hljs-params\">res</span>) &#123;<br>        wx.<span class=\"hljs-title function_\">getStorage</span>(&#123;<br>          <span class=\"hljs-attr\">key</span>: <span class=\"hljs-string\">&#x27;age&#x27;</span>,<br>          <span class=\"hljs-attr\">encrypt</span>: <span class=\"hljs-literal\">true</span>,<br>          <span class=\"hljs-title function_\">success</span>(<span class=\"hljs-params\">res</span>) &#123;<br>            <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res.<span class=\"hljs-property\">data</span>)<br>          &#125;<br>        &#125;)<br>      &#125;<br>    &#125;)<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n<p>!&gt; encrypt: true 本博主使用的微信开发版本是 <code>2.32.0</code> 存储数据进行加密没有效果，如有人知道为啥还请麻烦引导下</p>\n<h1 id=\"getstoragesync/getstorage\">getStorageSync/getStorage<a title=\"#getstoragesync/getstorage\" href=\"#getstoragesync/getstorage\"></a></h1>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs wxml\">&lt;!--index.wxml--&gt;<br>...<br><br>&lt;button bindtap=&quot;onGetStorage&quot;&gt;测试 Storage Api Get&lt;/button&gt;<br></code></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-comment\">// index.js</span><br><span class=\"hljs-title class_\">Page</span>(&#123;<br>  ...<br>    <br>  <span class=\"hljs-title function_\">onGetStorage</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">let</span> name = wx.<span class=\"hljs-title function_\">getStorageSync</span>(<span class=\"hljs-string\">&#x27;name&#x27;</span>)<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(name);<br><br>    wx.<span class=\"hljs-title function_\">getStorage</span>(&#123;<br>      <span class=\"hljs-attr\">key</span>: <span class=\"hljs-string\">&#x27;name&#x27;</span>,<br>      success (res) &#123;<br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res.<span class=\"hljs-property\">data</span>)<br>      &#125;<br>    &#125;)<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n<h1 id=\"clearstorage/clearstoragesync\">clearStorage/clearStorageSync<a title=\"#clearstorage/clearstoragesync\" href=\"#clearstorage/clearstoragesync\"></a></h1>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs wxml\">&lt;!--index.wxml--&gt;<br>...<br><br>&lt;button bindtap=&quot;onClearStorage&quot;&gt;测试 Storage Api Clear&lt;/button&gt;<br></code></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-comment\">// index.js</span><br><span class=\"hljs-title class_\">Page</span>(&#123;<br>  ...<br>    <br>  <span class=\"hljs-title function_\">onClearStorage</span>(<span class=\"hljs-params\"></span>) &#123;<br>    wx.<span class=\"hljs-title function_\">clearStorageSync</span>()<br>    wx.<span class=\"hljs-title function_\">clearStorage</span>()<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n<h1 id=\"removestorage/removestoragesync\">removeStorage/removeStorageSync<a title=\"#removestorage/removestoragesync\" href=\"#removestorage/removestoragesync\"></a></h1>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs wxml\">&lt;!--index.wxml--&gt;<br>...<br><br>&lt;button bindtap=&quot;onRmoveStorage&quot;&gt;测试 Storage Api Rmove&lt;/button&gt;<br></code></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-comment\">// index.js</span><br><span class=\"hljs-title class_\">Page</span>(&#123;<br>  ...<br>    <br>  <span class=\"hljs-title function_\">onRmoveStorage</span>(<span class=\"hljs-params\"></span>) &#123;<br>    wx.<span class=\"hljs-title function_\">removeStorage</span>(&#123;<br>      <span class=\"hljs-attr\">key</span>: <span class=\"hljs-string\">&#x27;name&#x27;</span>,<br>      success (res) &#123;<br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res)<br>      &#125;<br>    &#125;);<br><br>    wx.<span class=\"hljs-title function_\">removeStorageSync</span>(<span class=\"hljs-string\">&#x27;name&#x27;</span>)<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n<p>!&gt; 注意点：同步和异步可以交叉使用，也就是说，同步存的可以异步取等等</p>\n<h1 id=\"应用场景\">应用场景<a title=\"#应用场景\" href=\"#应用场景\"></a></h1>\n<ul>\n<li>存完之后立刻需要取，就用同步方法</li>\n<li>存完之后不需要立刻取，就用异步方法</li>\n</ul>\n","prev":{"title":"Keepalive-Haproxy高可用介绍","link":"2023/05/28/DevOps与云原生/Keepalive+Haproxy 高可用搭建/01-Keepalive-Haproxy高可用介绍"},"next":{"title":"微信小程序-获取用户位置","link":"2023/05/21/Web/微信小程序/微信小程序api/位置/60-微信小程序-获取用户位置"},"plink":"http://example.com/2023/05/21/Web/微信小程序/微信小程序api/数据缓存/59-微信小程序-Storage/","toc":[{"id":"存储数据","title":"存储数据","index":"1"},{"id":"setstoragesync/setstorage","title":"setStorageSync&#x2F;setStorage","index":"2"},{"id":"getstoragesync/getstorage","title":"getStorageSync&#x2F;getStorage","index":"3"},{"id":"clearstorage/clearstoragesync","title":"clearStorage&#x2F;clearStorageSync","index":"4"},{"id":"removestorage/removestoragesync","title":"removeStorage&#x2F;removeStorageSync","index":"5"},{"id":"应用场景","title":"应用场景","index":"6"}],"reading_time":"480 words in 3 min"}