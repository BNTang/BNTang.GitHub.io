{"title":"MongoDB-复制集搭建","date":"2022-10-15T14:53:06.000Z","date_formatted":{"ll":"Oct 15, 2022","L":"10/15/2022","MM-DD":"10-15"},"link":"2022/10/15/MongoDB/MongoDB-复制集/06-MongoDB-复制集搭建","tags":["MongoDB"],"updated":"2022-10-17T16:39:45.191Z","content":"<h1 id=\"mongodb-复制集搭建\">MongoDB 复制集搭建<a title=\"#mongodb-复制集搭建\" href=\"#mongodb-复制集搭建\"></a></h1>\n<ul>\n<li>下载 MongoDB: <a href=\"https://fastdl.mongodb.org/win32/mongodb-win32-x86_64-2012plus-4.2.6.zip\" target=\"_blank\">https://fastdl.mongodb.org/win32/mongodb-win32-x86_64-2012plus-4.2.6.zip</a></li>\n<li>解压 MongoDB 安装包</li>\n</ul>\n<p>在安装目录下新建 <code>data/conf/log</code> 3个文件夹，在conf文件夹下新建 <code>mongo.config</code>，在mongo.config中配置如下内容：</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs text\"># Where and how to store data.<br>storage:<br>  dbPath: D:\\Web\\MongoDB4.X\\MondoDB6666\\mongodb27018\\data<br>  journal:<br>    enabled: true<br># where to write logging data.<br>systemLog:<br>  destination: file<br>  logAppend: true<br>  path: D:\\Web\\MongoDB4.X\\MondoDB6666\\mongodb27018\\log\\mongod.log<br># network interfaces<br>net:<br>  port: 27018<br>  bindIp: 127.0.0.1<br></code></pre></td></tr></table></figure>\n<p>在 log 文件夹下创建一个 <code>mongod.log</code> 文件，然后分别进行拷贝两份，我这里分别有三分，端口号分别是，<code>27018</code>, <code>27019</code>, <code>27020</code>：</p>\n<p><img src=\"https://img2022.cnblogs.com/blog/2105804/202210/2105804-20221016201826937-1542374143.png\" alt=\"image-20221016201826545\" loading=\"lazy\" class=\"φbp\"></p>\n<p>!&gt; 注意修改 config 中的文件里面的 data 与 log 存放地址与端口号</p>\n<h1 id=\"注册配置-mongodb\">注册配置 MongoDB<a title=\"#注册配置-mongodb\" href=\"#注册配置-mongodb\"></a></h1>\n<p>注册成服务：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">mongod --config D:\\Web\\MongoDB4.X\\MondoDB6666\\mongodb27018\\conf\\mongo.config --serviceName <span class=\"hljs-string\">&quot;MongoDB27018&quot;</span> --serviceDisplayName <span class=\"hljs-string\">&quot;MongoDB27018&quot;</span> --replSet <span class=\"hljs-string\">&quot;it6666&quot;</span> --install<br>mongod --config D:\\Web\\MongoDB4.X\\MondoDB6666\\MongoDB27019\\conf\\mongo.config --serviceName <span class=\"hljs-string\">&quot;MongoDB27019&quot;</span> --serviceDisplayName <span class=\"hljs-string\">&quot;MongoDB27019&quot;</span> --replSet <span class=\"hljs-string\">&quot;it6666&quot;</span> --install<br>mongod --config D:\\Web\\MongoDB4.X\\MondoDB6666\\MongoDB27020\\conf\\mongo.config --serviceName <span class=\"hljs-string\">&quot;MongoDB27020&quot;</span> --serviceDisplayName <span class=\"hljs-string\">&quot;MongoDB27020&quot;</span> --replSet <span class=\"hljs-string\">&quot;it6666&quot;</span> --install<br></code></pre></td></tr></table></figure>\n<p>!&gt; 注意以上的 <code>--config</code> 记得更换成你自己的</p>\n<ul>\n<li>手动启动服务</li>\n<li>测试连接</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs shell\">mongo --host 127.0.0.1 --port 27018<br></code></pre></td></tr></table></figure>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs shell\">mongo --host 127.0.0.1 --port 27019<br></code></pre></td></tr></table></figure>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs shell\">mongo --host 127.0.0.1 --port 27020<br></code></pre></td></tr></table></figure>\n<h1 id=\"初始化复制集\">初始化复制集<a title=\"#初始化复制集\" href=\"#初始化复制集\"></a></h1>\n<p>!&gt; 在三台当中的其中一台进行执行如下命令即可初始化完毕：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs shell\">rs.initiate(&#123;<br>_id: &#x27;it6666&#x27;,<br>members: [<br>&#123;_id: 0, host: &#x27;127.0.0.1:27018&#x27;&#125;,<br>&#123;_id: 1, host: &#x27;127.0.0.1:27019&#x27;&#125;,<br>&#123;_id: 2, host: &#x27;127.0.0.1:27020&#x27;&#125;]<br>&#125;)<br></code></pre></td></tr></table></figure>\n<p><img src=\"https://img2022.cnblogs.com/blog/2105804/202210/2105804-20221018000909567-1715450637.png\" alt=\"image-20221018000909775\" loading=\"lazy\" class=\"φbp\"></p>\n<p>其它相关参数：</p>\n<ul>\n<li>_id 整数：节点的唯一标识</li>\n<li>host 字符串：节点的IP地址，包含端口号</li>\n<li>arbiterOnly 布尔值：是否为投票节点，默认是false。是设置投票(选举)节点有关的参数</li>\n<li>priority 整数：选举为主节点的权值，默认是1，范围0-1000</li>\n<li>hidden 布尔值：是否隐藏，默认false，是设置隐藏节点有关的参数</li>\n<li>votes 整数：投票数，默认为1，取值是0或1，是设置”投票“节点有关的参数</li>\n<li>slaveDelay 整数：延时复制，是设置延时节点有关的参数。单位秒(s)</li>\n</ul>\n<h1 id=\"在主节点写入读取\">在主节点写入读取<a title=\"#在主节点写入读取\" href=\"#在主节点写入读取\"></a></h1>\n<p>只能在主节点写，因为其它节点不能写只能读默认情况下副节点是不可以读取的想要在副节点读取要开启执行 <code>rs.slaveOk()</code> 即可：</p>\n<p><img src=\"https://img2022.cnblogs.com/blog/2105804/202210/2105804-20221018003344823-726150035.png\" alt=\"image-20221018003345167\" loading=\"lazy\" class=\"φbp\"></p>\n","prev":{"title":"MongoDB-分片开篇","link":"2022/10/23/MongoDB/MongoDB-分片/01-MongoDB-分片开篇"},"next":{"title":"MongoDB-复制集投票节点","link":"2022/10/15/MongoDB/MongoDB-复制集/05-MongoDB-复制集投票节点"},"plink":"http://example.com/2022/10/15/MongoDB/MongoDB-复制集/06-MongoDB-复制集搭建/","toc":[{"id":"mongodb-复制集搭建","title":"MongoDB 复制集搭建","index":"1"},{"id":"注册配置-mongodb","title":"注册配置 MongoDB","index":"2"},{"id":"初始化复制集","title":"初始化复制集","index":"3"},{"id":"在主节点写入读取","title":"在主节点写入读取","index":"4"}],"reading_time":"628 words in 4 min"}