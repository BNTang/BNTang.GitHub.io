{"title":"MongoDB-片键选择技巧","date":"2022-10-23T03:26:27.000Z","date_formatted":{"ll":"Oct 23, 2022","L":"10/23/2022","MM-DD":"10-23"},"link":"2022/10/23/MongoDB/MongoDB-分片/04-MongoDB-片键选择技巧","tags":["MongoDB"],"updated":"2022-10-23T15:13:16.098Z","content":"<h1 id=\"如何选择片键\">如何选择片键<a title=\"#如何选择片键\" href=\"#如何选择片键\"></a></h1>\n<p>使用分片的目的是为了将数据存储到不同的服务器上, 所以在选择片键的时候，<code>应该选择取值范围更广的字段作为片键</code>，因为如果取值范围太小, 那么划分出来的数据段就太少, 那么分配到不同服务器的概率就越小, 例如：取值如果只有 true 或 false, 那么就只能划分出两个数据段, 那么也就最多只能保存到两台服务器上。</p>\n<p><code>应该选择取值分配更平衡字段作为片键</code>，因为如果取值范围不平衡, 就会导致某一个数据段的数据太多, 某一台分片服务器压力太大, 例如: 将 age 作为片键, 但是我们的用户 90% 都集中中 20~30 岁, 那么就会导致保存 20~30 数据段的分片服务器存储数据过多压力过大。</p>\n<p><code>不应该选择单向增加或者减少的字段作为片键</code>, 因为如果取值是单向增加或者减少的, 那么就会出现可能出现的最小值数据段或者最大值数据段保存的数据过多, 对应的分片服务器压力过大。</p>\n<h1 id=\"片键选择技巧\">片键选择技巧<a title=\"#片键选择技巧\" href=\"#片键选择技巧\"></a></h1>\n<ul>\n<li>如果片键字段取值范围不够广, 那么我们可以使用复合片键</li>\n<li>如果片键字段的取值不够平衡, 那么我们可以使用复合片键</li>\n<li>如果片键字段的取值是单向增加或减少的, 那么我们可以使用片键字段的哈希值</li>\n</ul>\n<p>!&gt; 片键一旦选择就不能更改, 所以在前期选择片键时一定要多动脑</p>\n","prev":{"title":"MongoDB-分片优化","link":"2022/10/23/MongoDB/MongoDB-分片/05-MongoDB-分片优化"},"next":{"title":"MongoDB-分片片键","link":"2022/10/23/MongoDB/MongoDB-分片/03-MongoDB-分片片键"},"plink":"http://example.com/2022/10/23/MongoDB/MongoDB-分片/04-MongoDB-片键选择技巧/","toc":[{"id":"如何选择片键","title":"如何选择片键","index":"1"},{"id":"片键选择技巧","title":"片键选择技巧","index":"2"}],"reading_time":"440 words in 3 min"}