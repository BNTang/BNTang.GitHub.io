{"title":"『云存储』下载文件","date":"2023-12-03T09:46:02.000Z","date_formatted":{"ll":"Dec 3, 2023","L":"12/03/2023","MM-DD":"12-03"},"link":"2023/12/03/Web/微信小程序/云开发/68-『云存储』下载文件","tags":["云开发","微信小程序"],"updated":"2024-03-04T02:19:39.733Z","content":"<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202312/2105804-20231203183604164-80130059.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<h1 id=\"一、前言\">一、前言<a title=\"#一、前言\" href=\"#一、前言\"></a></h1>\n<blockquote>\n<ul>\n<li>本篇文章是『云存储』文章的第 2 篇，主要介绍『云存储』下载文件</li>\n</ul>\n</blockquote>\n<p>在前文中，我们详尽阐述了文件上传至云存储的全过程。现已掌握上传技巧，接下来，我们将详细探讨如何从云存储中有效下载文件。</p>\n<h1 id=\"二、主题\">二、主题<a title=\"#二、主题\" href=\"#二、主题\"></a></h1>\n<h2 id=\"2.1.下载云存储中的文件\">2.1.下载云存储中的文件<a title=\"#2.1.下载云存储中的文件\" href=\"#2.1.下载云存储中的文件\"></a></h2>\n<p>既然文件已经上传，接下来我们该如何操作才能将文件顺利下载至本地电脑呢？这个过程实际上非常直接。考虑到文件保存在云端，首先我们需要取得云端的存储对象。这可以通过访问 <code>wx.cloud</code> 接口轻松实现。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\">wx.<span class=\"hljs-property\">cloud</span><br></code></pre></td></tr></table></figure>\n<p>获得云端对象后，接下来您应使用一个名为 <code>downloadFile</code> 的方法来下载文件。您只需创建一个对象，并在该对象中指定您希望下载的文件。在编写此方法时，它会提供一个默认属性，称为 <code>url</code>。</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202402/2105804-20240225222206973-846123083.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>您只需要提供 URL，系统便能够自动获取文件。此外，通过使用文件的 ID 属性，还可以实现直接从云存储获取文件的功能。这种方式简便高效，便于直接从云端管理文件。</p>\n<p>首先，请登录云存储控制台。在您的文件列表中找到所需下载的图片文件。每个文件旁边，都配有一个独特的识别码，即 fileID。复制该 fileID 后，您就可以使用它来进行图片的下载操作。</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202402/2105804-20240225230522542-1696110351.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>接下来，我们将使用 <code>wx.cloud.downloadFile</code> 方法，并将获取的 <code>fileID</code> 传入 <code>fileID</code> 参数中。执行该方法后，您就可以成功下载文件了。</p>\n<p>代码就成了如下所示：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">async</span> <span class=\"hljs-title function_\">onDownTap</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">const</span> res = <span class=\"hljs-keyword\">await</span> wx.<span class=\"hljs-property\">cloud</span>.<span class=\"hljs-title function_\">downloadFile</span>(&#123;<br>        <span class=\"hljs-comment\">// 文件 ID</span><br>        <span class=\"hljs-attr\">fileID</span>: <span class=\"hljs-string\">&#x27;cloud://cloud1-5gnw7kej2c68cd30.636c-cloud1-5gnw7kej2c68cd30-1322890583/test/1705207755152.jpg&#x27;</span>,<br>    &#125;);<br><br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res);<br>&#125;<br></code></pre></td></tr></table></figure>\n<p>下载文件的代码编写完毕，现在我们可以开始测试。运行代码，并在控制台中查看输出结果。系统将输出一个临时文件路径（tempFilePath），该路径即为下载文件所在位置。</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202402/2105804-20240225231128515-1388682866.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>如果您希望这个结果更加明显地突出显示，那么可以创建一个数据对象，并在该对象中定义一个名为 <code>tempFilePath</code> 的变量来存储下载文件的路径，接着在页面上将其展示出来。</p>\n<p>最终逻辑 JS 代码如下：</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs diff\">// index.js<br><span class=\"hljs-addition\">+ data: &#123;</span><br><span class=\"hljs-addition\">+     tempFilePath: &quot;&quot;</span><br><span class=\"hljs-addition\">+ &#125;,</span><br><br>...<br><br>async onDownTap() &#123;<br>    const res = await wx.cloud.downloadFile(&#123;<br>        // 文件 ID<br>        fileID: &#x27;cloud://cloud1-5gnw7kej2c68cd30.636c-cloud1-5gnw7kej2c68cd30-1322890583/test/1705207755152.jpg&#x27;,<br>    &#125;);<br><br>    console.log(res);<br><br><span class=\"hljs-addition\">+    this.setData(&#123;</span><br><span class=\"hljs-addition\">+        tempFilePath: res.tempFilePath</span><br><span class=\"hljs-addition\">+    &#125;);</span><br>&#125;,<br></code></pre></td></tr></table></figure>\n<h2 id=\"2.2.显示已下载的云端存储文件\">2.2.显示已下载的云端存储文件<a title=\"#2.2.显示已下载的云端存储文件\" href=\"#2.2.显示已下载的云端存储文件\"></a></h2>\n<p>好的，代码编写到此已完成，成功将文件地址从云存储下载并保存。下一步，我们将开始编写页面。</p>\n<p>首先打开项目的结构代码文件，即 index.wxml。在页面代码中加入 image 组件，并将之前保存的 <code>tempFilePath</code> 作为 <code>src</code> 属性的值赋予 image 组件。然后，配置 image 组件的 <code>mode</code> 属性为 <code>widthFix</code>。此外，调整样式设置，确定 image 的 <code>width</code> 为 <code>100%</code> 以铺满容器宽度，<code>height</code> 设置为 <code>100px</code>，以此确保图片能够适当展示。这样，照片就能在页面中正确显示了。</p>\n<p>代码如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">image</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;&#123;&#123;tempFilePath&#125;&#125;&quot;</span> <span class=\"hljs-attr\">mode</span>=<span class=\"hljs-string\">&quot;widthFix&quot;</span> <span class=\"hljs-attr\">style</span>=<span class=\"hljs-string\">&quot;width: 100%;height: 100px;&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">image</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h2 id=\"2.3.测试结果\">2.3.测试结果<a title=\"#2.3.测试结果\" href=\"#2.3.测试结果\"></a></h2>\n<p>启动项目，导航至云存储相关的菜单项。当项目首次运行时，效果展示如下所示的图片：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202402/2105804-20240225232309600-1072792620.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>出现空白区域的原因是在我们的数据（data）中相关变量目前为空字符串。为了解决这个问题，只需点击下载按钮。紧接着，之前编写的代码会执行，将文件的临时路径存入变量tempFilePath中。一旦数据更新，页面便能够检测到变化并刷新，这样我们就获取到了图片的临时路径，可以自由地进行使用了。此时，页面上就能展示出我们在云存储中的文件图片。最终的效果如图所示：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202402/2105804-20240225233634828-1132694495.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<h1 id=\"三、总结\">三、总结<a title=\"#三、总结\" href=\"#三、总结\"></a></h1>\n<p>通过本文的学习，您将能够掌握以下核心知识点：</p>\n<ul>\n<li>1.下载云存储中的文件</li>\n<li>2.显示已下载的云端存储文件</li>\n</ul>\n<blockquote>\n<p>最后，我要感谢您阅读本文。如果您觉得文章有用，请不吝点赞、收藏或者转发。您的支持是我不断创作与分享的最大动力。让我们携手在学习的旅途上相互促进，共同享受知识带来的快乐。</p>\n</blockquote>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202312/2105804-20231211215004818-977875224.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n","prev":{"title":"『云存储』上传文件","link":"2023/12/03/Web/微信小程序/云开发/67-『云存储』上传文件"},"next":{"title":"『云存储』删除文件","link":"2023/12/03/Web/微信小程序/云开发/69-『云存储』删除文件"},"plink":"http://example.com/2023/12/03/Web/微信小程序/云开发/68-『云存储』下载文件/","toc":[{"id":"一、前言","title":"一、前言","index":"1"},{"id":"二、主题","title":"二、主题","index":"2","children":[{"id":"2.1.下载云存储中的文件","title":"2.1.下载云存储中的文件","index":"2.1"},{"id":"2.2.显示已下载的云端存储文件","title":"2.2.显示已下载的云端存储文件","index":"2.2"},{"id":"2.3.测试结果","title":"2.3.测试结果","index":"2.3"}]},{"id":"三、总结","title":"三、总结","index":"3"}]}