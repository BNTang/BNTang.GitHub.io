{"title":"『云存储』获取临时路径","date":"2023-12-03T09:46:02.000Z","date_formatted":{"ll":"Dec 3, 2023","L":"12/03/2023","MM-DD":"12-03"},"link":"2023/12/03/Web/微信小程序/云开发/70-『云存储』获取临时路径","tags":["云开发","微信小程序"],"updated":"2024-03-04T02:19:39.754Z","content":"<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202312/2105804-20231203183717220-901860769.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<h1 id=\"一、前言\">一、前言<a title=\"#一、前言\" href=\"#一、前言\"></a></h1>\n<blockquote>\n<ul>\n<li>本篇文章是『云存储』文章的第 4 篇，主要介绍『云存储』获取临时路径</li>\n</ul>\n</blockquote>\n<p>在上一篇文章中，我们详细介绍了如何删除云存储中的文件。本文将向大家阐述如何获取云存储文件的临时路径。</p>\n<h1 id=\"二、获取临时路径\">二、获取临时路径<a title=\"#二、获取临时路径\" href=\"#二、获取临时路径\"></a></h1>\n<p>首先，让我们思考两个问题。第一个，为什么需要获取文件的临时路径？第二个，直接使用云文件的地址不行吗？带着这两个问题，让我们继续探讨下去。</p>\n<p>在介绍前，需要先说明一点：我们在云控制台上传的文件，默认只能在小程序中使用。如何验证这一点呢？举个简单的示例就能说明。</p>\n<p>我编写了一个 image 组件并赋予其相应图片的 fileID，在小程序中运行以查看展示效果，代码如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">image</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;cloud://cloud1-5gnw7kej2c68cd30.636c-cloud1-5gnw7kej2c68cd30-1322890583/dengdeng3.jpg&quot;</span> <span class=\"hljs-attr\">mode</span>=<span class=\"hljs-string\">&quot;widthFix&quot;</span> <span class=\"hljs-attr\">style</span>=<span class=\"hljs-string\">&quot;width: 100%;height: 100px;&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">image</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<p>代码非常的简单，只是一个 image 组件，src 属性赋予了图片的 fileID，然后设置了图片的宽度和高度，fileID 是我们在云控制台上传文件后获取的：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202402/2105804-20240229000544910-1726244157.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>我们来看一下效果。</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240114214201878-1616609441.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>我们可以看到，在小程序中图片能够正常显示。但如果直接将链接粘贴到浏览器并回车，就会发现图片无法正常展示。</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240114214348880-731865888.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>此示例印证了我的观点，由此解释了为何要讲解临时路径以及本文的要点。</p>\n<blockquote>\n<p>重要提示：上传至云存储的文件默认仅限于小程序内使用。若需在其他环境中访问，必须通过生成临时路径的方法来实现。</p>\n</blockquote>\n<p>经过上述验证，我们已经明白 “直接使用云文件的地址不行吗？” 这一问题的答案。下一步，我们将揭示 “为什么需要获取文件的临时路径？” 请继续关注。</p>\n<p>下面，让我们来看看如何轻松获取临时路径。在小程序中，只需调用 <code>wx.cloud.getTempFileURL</code> 这个 API 就可以了，它的作用正是用于获取临时路径。接下来，我们将详细介绍这个 API 的使用方法。</p>\n<p>首先提供下面的代码示例，它简单地调用了 <code>wx.cloud.getTempFileURL</code> API。您只需将所需文件的 fileID 放入数组中，再调用此 API，随即可获得其临时路径。具体代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">async</span> <span class=\"hljs-title function_\">onTempPathTap</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">const</span> res = <span class=\"hljs-keyword\">await</span> wx.<span class=\"hljs-property\">cloud</span>.<span class=\"hljs-title function_\">getTempFileURL</span>(&#123;<br>        <span class=\"hljs-attr\">fileList</span>: [<span class=\"hljs-string\">&#x27;cloud://cloud1-5gnw7kej2c68cd30.636c-cloud1-5gnw7kej2c68cd30-1322890583/dengdeng3.jpg&#x27;</span>],<br>    &#125;);<br><br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res);<br>&#125;,<br></code></pre></td></tr></table></figure>\n<p>我们来分析一下该 API 的参数。<code>wx.cloud.getTempFileURL</code> 只接受一个参数，即 <code>fileList</code>。这是一个数组，您应当将那些需要获取临时路径的文件的 fileID 加入此数组。调用此 API 后，便可获得这些文件的临时路径。接下来，我们来看这个 API 的返回结果。</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240114215002808-732167722.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>返回结果是一个包含 <code>fileList</code> 属性的对象，其保存了本次请求的文件临时路径。在 <code>fileList</code> 中，每个对象都含有 <code>tempFileURL</code> 属性，它即是我们所需的临时路径。将这个临时路径复制到浏览器地址栏并回车，我们的图片即可正常显示。</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240114215245884-1883352413.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>当然，我们也可以把这个临时路径赋给 image 组件，在小程序内展示图片，效果同样理想。这部分就不展示截图了，大家可以亲自尝试一下。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">image</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;https://636c-cloud1-5gnw7kej2c68cd30-1322890583.tcb.qcloud.la/dengdeng3.jpg&quot;</span> <span class=\"hljs-attr\">mode</span>=<span class=\"hljs-string\">&quot;widthFix&quot;</span> <span class=\"hljs-attr\">style</span>=<span class=\"hljs-string\">&quot;width: 100%;height: 100px;&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">image</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h1 id=\"三、总结\">三、总结<a title=\"#三、总结\" href=\"#三、总结\"></a></h1>\n<p>通过本文的学习，您将能够掌握以下核心知识点：</p>\n<ul>\n<li>1.获取云存储文件的临时路径</li>\n<li>2.临时路径的作用</li>\n</ul>\n<blockquote>\n<p>最后，我要感谢您阅读本文。如果您觉得文章有用，请不吝点赞、收藏或者转发。您的支持是我不断创作与分享的最大动力。让我们携手在学习的旅途上相互促进，共同享受知识带来的快乐。</p>\n</blockquote>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202312/2105804-20231211215004818-977875224.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n","prev":{"title":"『云函数』基本使用","link":"2023/12/03/Web/微信小程序/云开发/71-『云函数』基本使用"},"next":{"title":"『云函数』处理数据","link":"2023/12/03/Web/微信小程序/云开发/73-『云函数』处理数据"},"plink":"http://example.com/2023/12/03/Web/微信小程序/云开发/70-『云存储』获取临时路径/","toc":[{"id":"一、前言","title":"一、前言","index":"1"},{"id":"二、获取临时路径","title":"二、获取临时路径","index":"2"},{"id":"三、总结","title":"三、总结","index":"3"}]}