{"title":"MongoDB-复制集选举规则","date":"2022-09-24T09:23:07.000Z","date_formatted":{"ll":"Sep 24, 2022","L":"09/24/2022","MM-DD":"09-24"},"link":"2022/09/24/MongoDB/MongoDB-复制集/03-MongoDB-复制集选举规则","tags":["MongoDB"],"updated":"2022-09-24T09:35:01.783Z","content":"<h1 id=\"选举规则\">选举规则<a title=\"#选举规则\" href=\"#选举规则\"></a></h1>\n<ul>\n<li>一旦发现主节点没有响应 / 发送心跳请求, 那么副节点就会认为主节点挂了</li>\n<li>一旦发现主节点挂了, 任意一个副节点都可以发起选举</li>\n<li>(发起选举的节点我们称之为 <code>候选节点</code>, 每一个节点内部都有一个 <code>选举计数器</code>)</li>\n<li>发起选举的节点会给自己先投一票, 然后将自己的票数依次发送给其它节点</li>\n</ul>\n<p>其它节点收到投票请求后, 会先利用发送过来的票数同步自己计数器的票数:</p>\n<ul>\n<li>\n<p>然后再对比自己的数据和候选节点的数据哪个更完整</p>\n</li>\n<li>\n<p>如果自己的更完整, 那么会投出反对票</p>\n</li>\n<li>\n<p>如果候选节点的更完整, 那么会投出赞同票</p>\n</li>\n<li>\n<p>最后如果超过半数的节点投出赞同票, 那么候选节点就会变成主节点</p>\n</li>\n<li>\n<p>最后如果没有超过半数节点投出赞同票, 那么其它节点会重新发起选举, 重复上述过程</p>\n</li>\n</ul>\n<p>!&gt; 一个复制集中最多只能有 <code>7</code> 个投票节点</p>\n<p>!&gt; 如果某个节点没有返回投票结果, 那么默认就是不赞同, 挂掉的节点不会返回结果</p>\n<p>!&gt; 因为选举需要超过半数节点同意, 才会将副节点变成主节点, 所以在企业开发中一个复制集至少需要 3 个节点，否则一旦主节点挂了, 永远无法完成投票</p>\n<p>!&gt; 因为选举需要超过半数节点同意, 才会将副节点变成主节点, 所以在企业开发中节点的个数最好是 <code>奇数</code></p>\n<h1 id=\"触发选举的其它条件\">触发选举的其它条件<a title=\"#触发选举的其它条件\" href=\"#触发选举的其它条件\"></a></h1>\n<ul>\n<li>初始化复制集时, 会自动触发选举</li>\n<li>有新节点加入时, 会自动触发选举</li>\n<li>当前主节点挂掉时, 会自动触发选举</li>\n</ul>\n","prev":{"title":"MongoDB-复制集同步规则","link":"2022/09/24/MongoDB/MongoDB-复制集/04-MongoDB-复制集同步规则"},"next":{"title":"MongoDB-复制集特点","link":"2022/09/24/MongoDB/MongoDB-复制集/02-MongoDB-复制集特点"},"plink":"http://example.com/2022/09/24/MongoDB/MongoDB-复制集/03-MongoDB-复制集选举规则/","toc":[{"id":"选举规则","title":"选举规则","index":"1"},{"id":"触发选举的其它条件","title":"触发选举的其它条件","index":"2"}],"reading_time":"485 words in 3 min"}