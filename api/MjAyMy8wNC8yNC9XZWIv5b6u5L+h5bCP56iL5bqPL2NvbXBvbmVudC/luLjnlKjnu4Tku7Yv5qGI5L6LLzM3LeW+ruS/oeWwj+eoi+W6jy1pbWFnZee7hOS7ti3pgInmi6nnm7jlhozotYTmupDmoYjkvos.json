{"title":"微信小程序-image组件-选择相册资源案例","date":"2023-04-23T16:50:36.000Z","date_formatted":{"ll":"Apr 24, 2023","L":"04/24/2023","MM-DD":"04-24"},"link":"2023/04/24/Web/微信小程序/component/常用组件/案例/37-微信小程序-image组件-选择相册资源案例","tags":["微信小程序"],"updated":"2023-05-13T09:50:44.746Z","content":"<p>在我们企业开发当中经常有个人中心等相关需求，这些需求当中有一个功能点就是用户头像信息，这种信息用户可以选择自己手机当中的资源进行上传并保存设置。本章就是来介绍下这种功能在微信小程序当中该如何进行实现。</p>\n<p>首先我们在首页当中放一个 image 组件用于展示图片：</p>\n<p>index.wxml:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">image</span> <span class=\"hljs-attr\">mode</span>=<span class=\"hljs-string\">&quot;widthFix&quot;</span> </span><br><span class=\"hljs-tag\">       <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;&#123;&#123;filePath&#125;&#125;&quot;</span></span><br><span class=\"hljs-tag\">/&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">bindtap</span>=<span class=\"hljs-string\">&quot;onChooseImage&quot;</span>&gt;</span>选择头像<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<p>我们的 src 是不确定的，所以待会需要在 JS 逻辑代码当中定义一下，然后又紧接着编写了一个按钮，用来点击这个按钮来选择需要更换的头像资源，然后这个 WXML 文件内容就编写完毕了。</p>\n<p>接下来开始编写 JS，在微信小程序当中官方为我们提供了打开相册的API，可以通过 <code>wx.chooseMedia</code> 的API我们就可以打开相册，选择图片or视频，我们只需要在这个接口的success回调函数当中在重新赋值下我们的不确定地址变量即可完成上传。</p>\n<p>本文在官方文档当中寻找接口的过程，首先我去官方文档的API进行查找找到一个，<code>wx.chooseImage</code> 但是呢官方提示说 <code>从基础库 2.21.0 开始，本接口停止维护，请使用 wx.chooseMedia 代替</code> 然后就有了接下来的 <code>wx.chooseMedia</code>，wx.chooseMedia 官方文档地址：<a href=\"https://developers.weixin.qq.com/miniprogram/dev/api/media/video/wx.chooseMedia.html\" target=\"_blank\">https://developers.weixin.qq.com/miniprogram/dev/api/media/video/wx.chooseMedia.html</a></p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202304/2105804-20230424010929364-1028333777.png\" alt=\"img\" loading=\"lazy\" class=\"φbp\"></p>\n<p>官方也提供了使用示例代码，其它的相关属性大家自行去阅读下文档即可。</p>\n<p>index.js:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-title class_\">Page</span>(&#123;<br>  <span class=\"hljs-attr\">data</span>: &#123;<br>    <span class=\"hljs-attr\">filePath</span>: <span class=\"hljs-string\">&quot;&quot;</span><br>  &#125;,<br>  <span class=\"hljs-title function_\">onChooseImage</span>(<span class=\"hljs-params\"></span>)&#123;<br>    wx.<span class=\"hljs-title function_\">chooseMedia</span>(&#123;<br>      <span class=\"hljs-attr\">mediaType</span>: <span class=\"hljs-string\">&quot;image&quot;</span>,<br>      <span class=\"hljs-attr\">success</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">res</span>) =&gt;</span> &#123;<br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res);<br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res.<span class=\"hljs-property\">tempFiles</span>[<span class=\"hljs-number\">0</span>].<span class=\"hljs-property\">tempFilePath</span>)<br>        <br>        <span class=\"hljs-keyword\">const</span> path = res.<span class=\"hljs-property\">tempFiles</span>[<span class=\"hljs-number\">0</span>].<span class=\"hljs-property\">tempFilePath</span>;<br>        <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">setData</span>(&#123;<span class=\"hljs-attr\">filePath</span>: path&#125;);<br>      &#125;<br>    &#125;)<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>","prev":{"title":"微信小程序-scrollview","link":"2023/05/07/Web/微信小程序/component/常用组件/38-微信小程序-scrollview"},"next":{"title":"微信小程序-image组件","link":"2023/04/23/Web/微信小程序/component/常用组件/36-微信小程序-image组件"},"plink":"http://example.com/2023/04/24/Web/微信小程序/component/常用组件/案例/37-微信小程序-image组件-选择相册资源案例/","reading_time":"495 words in 3 min"}