{"title":"MongoDB-多对多关系","date":"2022-09-10T08:59:25.000Z","date_formatted":{"ll":"Sep 10, 2022","L":"09/10/2022","MM-DD":"09-10"},"link":"2022/09/10/MongoDB/索引/MongoDB4.x-数据模型/04-MongoDB-多对多关系","tags":["MongoDB"],"updated":"2022-09-10T10:26:50.721Z","content":"<h1 id=\"文档多对多关系\">文档多对多关系<a title=\"#文档多对多关系\" href=\"#文档多对多关系\"></a></h1>\n<ul>\n<li>一个学生有多个老师</li>\n<li>一个老师有多个学生</li>\n</ul>\n<h2 id=\"内嵌式结构\">内嵌式结构<a title=\"#内嵌式结构\" href=\"#内嵌式结构\"></a></h2>\n<p>学生与老师：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.students.insert(<span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;zs&#x27;<span class=\"hljs-punctuation\">,</span> teachers<span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;BNTang&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;Jonathan_Lee&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br><span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;ls&#x27;<span class=\"hljs-punctuation\">,</span> teachers<span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;BNTang&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;Jonathan_Lee&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">]</span>)<br></code></pre></td></tr></table></figure>\n<p>老师与学生：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.teachers.insert(<span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;BNTang&#x27;<span class=\"hljs-punctuation\">,</span> students<span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;zs&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;ls&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br><span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;Jonathan_Lee&#x27;<span class=\"hljs-punctuation\">,</span> students<span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;zs&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;ls&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">]</span>)<br></code></pre></td></tr></table></figure>\n<p>查询：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.students.find(<span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;zs&#x27;<span class=\"hljs-punctuation\">&#125;</span>)<br>db.teachers.find(<span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;BNTang&#x27;<span class=\"hljs-punctuation\">&#125;</span>)<br></code></pre></td></tr></table></figure>\n<h3 id=\"优势\">优势<a title=\"#优势\" href=\"#优势\"></a></h3>\n<p>一次查询就能得到所有数据</p>\n<h3 id=\"劣势\">劣势<a title=\"#劣势\" href=\"#劣势\"></a></h3>\n<p>冗余数据较多, 更新和管理较为复杂</p>\n<h3 id=\"应用场景\">应用场景<a title=\"#应用场景\" href=\"#应用场景\"></a></h3>\n<p>数据比较简单 / 查询频率较高数据</p>\n<h2 id=\"规范式结构\">规范式结构<a title=\"#规范式结构\" href=\"#规范式结构\"></a></h2>\n<p>学生：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.students.insert(<span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">&#123;</span>_id<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">1</span><span class=\"hljs-punctuation\">,</span> name<span class=\"hljs-punctuation\">:</span>&#x27;zs&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><span class=\"hljs-punctuation\">&#123;</span>_id<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">2</span><span class=\"hljs-punctuation\">,</span> name<span class=\"hljs-punctuation\">:</span>&#x27;ls&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">]</span>)<br></code></pre></td></tr></table></figure>\n<p>老师：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.teachers.insert(<span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">&#123;</span>_id<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">3</span><span class=\"hljs-punctuation\">,</span> name<span class=\"hljs-punctuation\">:</span>&#x27;BNTang&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><span class=\"hljs-punctuation\">&#123;</span>_id<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">4</span><span class=\"hljs-punctuation\">,</span> name<span class=\"hljs-punctuation\">:</span>&#x27;Jonathan_Lee&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">]</span>)<br></code></pre></td></tr></table></figure>\n<p>关系：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.relation.insert(<span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">&#123;</span>stuId<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">1</span><span class=\"hljs-punctuation\">,</span> teacherId<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">3</span><span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><span class=\"hljs-punctuation\">&#123;</span>stuId<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">1</span><span class=\"hljs-punctuation\">,</span> teacherId<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">4</span><span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><span class=\"hljs-punctuation\">&#123;</span>stuId<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">2</span><span class=\"hljs-punctuation\">,</span> teacherId<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">3</span><span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><span class=\"hljs-punctuation\">&#123;</span>stuId<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">2</span><span class=\"hljs-punctuation\">,</span> teacherId<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">4</span><span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">]</span>)<br></code></pre></td></tr></table></figure>\n<p>查询：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.students.aggregate(<span class=\"hljs-punctuation\">[</span><br>    <span class=\"hljs-punctuation\">&#123;</span>$lookup<span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>        from<span class=\"hljs-punctuation\">:</span> &#x27;relation&#x27;<span class=\"hljs-punctuation\">,</span><br>        localField<span class=\"hljs-punctuation\">:</span> &#x27;_id&#x27;<span class=\"hljs-punctuation\">,</span><br>        foreignField<span class=\"hljs-punctuation\">:</span>&#x27;stuId&#x27;<span class=\"hljs-punctuation\">,</span><br>        as<span class=\"hljs-punctuation\">:</span> &#x27;relation&#x27;<br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span>$lookup<span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>        from<span class=\"hljs-punctuation\">:</span> &#x27;teachers&#x27;<span class=\"hljs-punctuation\">,</span><br>        localField<span class=\"hljs-punctuation\">:</span> &#x27;relation.teacherId&#x27;<span class=\"hljs-punctuation\">,</span><br>        foreignField<span class=\"hljs-punctuation\">:</span>&#x27;_id&#x27;<span class=\"hljs-punctuation\">,</span><br>        as<span class=\"hljs-punctuation\">:</span> &#x27;teachers&#x27;<br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span>$project<span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span>_id<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">0</span><span class=\"hljs-punctuation\">,</span> name<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">1</span><span class=\"hljs-punctuation\">,</span> teachers<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">1</span><span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">&#125;</span><br><span class=\"hljs-punctuation\">]</span>)<br></code></pre></td></tr></table></figure>\n<h3 id=\"优势-1\">优势<a title=\"#优势-1\" href=\"#优势-1\"></a></h3>\n<p>冗余数据较少, 更新较为方便</p>\n<h3 id=\"劣势-1\">劣势<a title=\"#劣势-1\" href=\"#劣势-1\"></a></h3>\n<p>查询数据相对内嵌结果稍微有点复杂</p>\n<h3 id=\"应用场景-1\">应用场景<a title=\"#应用场景-1\" href=\"#应用场景-1\"></a></h3>\n<p>数据比较复杂 / 更新频率较高数据</p>\n","prev":{"title":"MongoDB-树形结构","link":"2022/09/10/MongoDB/索引/MongoDB4.x-数据模型/05-MongoDB-树形结构"},"next":{"title":"MongoDB-一对多关系","link":"2022/09/04/MongoDB/索引/MongoDB4.x-数据模型/03-MongoDB-一对多关系"},"plink":"http://example.com/2022/09/10/MongoDB/索引/MongoDB4.x-数据模型/04-MongoDB-多对多关系/","toc":[{"id":"文档多对多关系","title":"文档多对多关系","index":"1","children":[{"id":"内嵌式结构","title":"内嵌式结构","index":"1.1","children":[{"id":"优势","title":"优势","index":"1.1.1"},{"id":"劣势","title":"劣势","index":"1.1.2"},{"id":"应用场景","title":"应用场景","index":"1.1.3"}]},{"id":"规范式结构","title":"规范式结构","index":"1.2","children":[{"id":"优势-1","title":"优势","index":"1.2.1"},{"id":"劣势-1","title":"劣势","index":"1.2.2"},{"id":"应用场景-1","title":"应用场景","index":"1.2.3"}]}]}],"reading_time":"292 words in 2 min"}