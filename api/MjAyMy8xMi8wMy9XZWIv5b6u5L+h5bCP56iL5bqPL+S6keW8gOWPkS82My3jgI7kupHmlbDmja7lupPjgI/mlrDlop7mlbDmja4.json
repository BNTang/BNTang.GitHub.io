{"title":"『云数据库』新增数据","date":"2023-12-03T09:46:02.000Z","date_formatted":{"ll":"Dec 3, 2023","L":"12/03/2023","MM-DD":"12-03"},"link":"2023/12/03/Web/微信小程序/云开发/63-『云数据库』新增数据","tags":["云开发","微信小程序"],"updated":"2024-01-19T03:14:11.090Z","content":"<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202312/2105804-20231203174821798-1718271110.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<h1 id=\"1.前言\">1.前言<a title=\"#1.前言\" href=\"#1.前言\"></a></h1>\n<p>上篇文章，带着大家，用微信小程序开发工具提供的图形化界面来使用了一下云数据库和云存储，那么本篇主要是介绍一下我们来用代码操作云数据库的新增操作。</p>\n<h1 id=\"2.创建项目\">2.创建项目<a title=\"#2.创建项目\" href=\"#2.创建项目\"></a></h1>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240111232554572-1344765005.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<h2 id=\"2.1.目录结构\">2.1.目录结构<a title=\"#2.1.目录结构\" href=\"#2.1.目录结构\"></a></h2>\n<p>首先观察本次创建项目的目录结构，与之前的项目目录结构有所不同，以前的项目中只有一个文件夹，现在的项目中有两个文件夹，一个是 <code>miniprogram</code> 文件夹，一个是 <code>cloudfunctions</code> 文件夹，其中 <code>miniprogram</code> 文件夹是用来存放小程序的前端代码的，<code>cloudfunctions</code> 文件夹是用来存放小程序的后端代码的。</p>\n<p>当然了，这两个文件夹名称都是可以更改的，如果要更改的话，首先要找到项目目录结构中的 <code>project.config.json</code> 文件，然后在这个文件中找到 <code>cloudfunctionRoot</code> 和 <code>miniprogramRoot</code> 这两个属性，然后将这两个属性的值更改为你想要的文件夹名称即可。</p>\n<p>也就是告诉微信小程序你的云函数代码在哪个文件夹，你的小程序代码在哪个文件夹，这个是与原生开发不同的地方。</p>\n<p>知道了这些之后，我们就可以开始来写代码了。写代码之前首先将一些我不认识的文件夹与文件先删除一下你们照着我的来即可。</p>\n<p>删除 components 下的 cloudTipModal：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240111233326313-259888662.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>删除 pages 下的所有内容：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240111233440577-495875316.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<h1 id=\"3.搭建演示页面\">3.搭建演示页面<a title=\"#3.搭建演示页面\" href=\"#3.搭建演示页面\"></a></h1>\n<p>在 pages 下分别创建 cloud-fn、cloud-db、cloud-storage 三个文件夹，代表的含义就是云函数、云数据库、云存储，然后在这三个文件夹下分别创建 index 页面：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240111234043342-913750463.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>页面创建好了，需要展示一下所有要更改一下 <code>app.json</code> 文件，添加 tabBar 配置：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-attr\">&quot;tabBar&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>  <span class=\"hljs-attr\">&quot;list&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>      <span class=\"hljs-attr\">&quot;pagePath&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;pages/cloud-db/index&quot;</span><span class=\"hljs-punctuation\">,</span><br>      <span class=\"hljs-attr\">&quot;text&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;云数据库&quot;</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>      <span class=\"hljs-attr\">&quot;pagePath&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;pages/cloud-fn/index&quot;</span><span class=\"hljs-punctuation\">,</span><br>      <span class=\"hljs-attr\">&quot;text&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;云函数&quot;</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>      <span class=\"hljs-attr\">&quot;pagePath&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;pages/cloud-storage/index&quot;</span><span class=\"hljs-punctuation\">,</span><br>      <span class=\"hljs-attr\">&quot;text&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;云存储&quot;</span><br>    <span class=\"hljs-punctuation\">&#125;</span><br>  <span class=\"hljs-punctuation\">]</span><br><span class=\"hljs-punctuation\">&#125;</span><br></code></pre></td></tr></table></figure>\n<p>除了添加 tabBar 配置之外，还需要将 pages 下的 index 页面的配置删除, 包括那些之前自动创建的页面配置：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-attr\">&quot;pages&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><br>  <span class=\"hljs-string\">&quot;pages/cloud-db/index&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-string\">&quot;pages/cloud-fn/index&quot;</span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-string\">&quot;pages/cloud-storage/index&quot;</span><br><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span><br></code></pre></td></tr></table></figure>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240111234749339-1293541334.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>这样我们的页面就创建好了，接下来就是来写代码了。</p>\n<h1 id=\"4.云数据库\">4.云数据库<a title=\"#4.云数据库\" href=\"#4.云数据库\"></a></h1>\n<p>首先来看云数据库也就是云存储, 更改 cloud-db/index.wxml 文件，分别添加 CRUD 的按钮，CRUD 单词分别是 Create、Read、Update、Delete 的首字母缩写，也就是新增、查询、修改、删除的意思：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;primary&quot;</span> <span class=\"hljs-attr\">bindtap</span>=<span class=\"hljs-string\">&quot;onAddTap&quot;</span>&gt;</span>新增<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;primary&quot;</span> <span class=\"hljs-attr\">bindtap</span>=<span class=\"hljs-string\">&quot;onRemoveTap&quot;</span>&gt;</span>删除<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;primary&quot;</span> <span class=\"hljs-attr\">bindtap</span>=<span class=\"hljs-string\">&quot;onUpdateTap&quot;</span>&gt;</span>修改<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;primary&quot;</span> <span class=\"hljs-attr\">bindtap</span>=<span class=\"hljs-string\">&quot;onQueryTap&quot;</span>&gt;</span>查询<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<p>然后在 cloud-db/index.js 文件中添加对应的事件处理函数：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-title class_\">Page</span>(&#123;<br>    <span class=\"hljs-title function_\">onAddTap</span>(<span class=\"hljs-params\"></span>) &#123;<br><br>    &#125;,<br>    <span class=\"hljs-title function_\">onQueryTap</span>(<span class=\"hljs-params\"></span>) &#123;<br><br>    &#125;,<br>    <span class=\"hljs-title function_\">onRemoveTap</span>(<span class=\"hljs-params\"></span>) &#123;<br><br>    &#125;,<br>    <span class=\"hljs-title function_\">onUpdateTap</span>(<span class=\"hljs-params\"></span>) &#123;<br><br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>\n<p>好页面按钮与事件处理函数都添加好了，接下来就要介绍一下如何来操作云数据库了。</p>\n<blockquote>\n<p>注意点：在操作云数据库之前，一定要先初始化</p>\n</blockquote>\n<h2 id=\"4.1.初始化\">4.1.初始化<a title=\"#4.1.初始化\" href=\"#4.1.初始化\"></a></h2>\n<p>找到 miniprogram/app.js 文件，然后在这个文件中添加初始化代码, 你打开这个文件当中有一行 <code>wx.cloud.init</code> 的代码，这行代码就是用来初始化的，我们只需要在这行代码的基础上添加一些配置即可。</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240111235830164-434911653.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>有注释介绍到 <code>env 参数决定接下来小程序发起的云开发调用（wx.cloud.xxx）会默认请求到哪个云环境的资源</code>，也就是说我们需要在这里配置一下我们的云环境，那么我们的云环境在哪里呢？我们的云环境在云开发控制台中，我们打开云开发控制台，然后在这里找到环境:</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240111235954878-2019389953.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>在云开发控制台中，有一个当前环境，这个当前环境我们是可以创建多个的，这个当前环境就是指定我们本次要使用的云环境，然后在控制台管理界面中可以看到我们的云环境的环境 ID，我们将这个环境 ID 复制下来，然后回到我们的小程序代码中，将这个环境 ID 配置到我们的初始化代码中即可。</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240112000620111-2868069.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>好 env 介绍完毕，在来看一下 <code>traceUser</code> 参数：</p>\n<ul>\n<li>traceUser: 是否要追踪用户的行为。设置为 true，用户可在管理端看到用户访问记录。默认为 false。</li>\n</ul>\n<p>这个当前环境就是相当于一台服务器，你就理解为每个环境都相当于一台服务器，我将我创建的云环境 ID 放入到了代码中就是告诉微信小程序我目前用的那台服务器，这样我们就可以使用云数据库了。</p>\n<h2 id=\"4.2.新增\">4.2.新增<a title=\"#4.2.新增\" href=\"#4.2.新增\"></a></h2>\n<p>接下来就是来介绍一下如何来新增数据了，如果想要通过代码来新增数据，分为如下几步：</p>\n<ul>\n<li>1.拿到当前环境对应的数据库</li>\n<li>2.拿到当前数据库中指定的集合（也就是本次要操作的集合）</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-comment\">// 1.拿到当前环境对应的数据库</span><br><span class=\"hljs-keyword\">const</span> db = wx.<span class=\"hljs-property\">cloud</span>.<span class=\"hljs-title function_\">database</span>();<br><br><span class=\"hljs-comment\">// 2.拿到当前数据库中指定的集合（也就是本次要操作的集合）</span><br><span class=\"hljs-keyword\">const</span> stuCollection = db.<span class=\"hljs-title function_\">collection</span>(<span class=\"hljs-string\">&#x27;stu&#x27;</span>);<br></code></pre></td></tr></table></figure>\n<p>通过如上两步，我们就可以拿到我们要操作的集合了，然后就可以来进行数据的新增了，新增数据的方法是 <code>add</code>，这个方法是一个异步方法，所以我们需要使用 <code>async</code> 和 <code>await</code> 来进行异步操作：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">async</span> <span class=\"hljs-title function_\">onAddTap</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">const</span> res = <span class=\"hljs-keyword\">await</span> stuCollection.<span class=\"hljs-title function_\">add</span>(&#123;<br>        <span class=\"hljs-attr\">data</span>: &#123;<br>            <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;翠花&#x27;</span>,<br>            <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">18</span>,<br>        &#125;<br>    &#125;)<br><br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res);<br>&#125;,<br></code></pre></td></tr></table></figure>\n<p>代码写完了，测试一下，点击新增按钮，然后在控制台中可以看到新增成功的数据：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240112001920995-385251950.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>好了，云数据库的新增操作就介绍到这里就结束了，通过本文大家可以了解到如何通过代码来操作云数据库的新增操作。</p>\n<h1 id=\"end\">End<a title=\"#end\" href=\"#end\"></a></h1>\n<p>本篇文章内容介绍到这就结束了，我们下期再见，感谢大家的观看，谢谢大家。</p>\n<blockquote>\n<ul>\n<li>🐤如果您对本文有任何疑问或想法，请在评论区留言，我将很乐意与您交流。</li>\n<li>🐰您的每一条评论对我都至关重要，我会尽快给予回复。</li>\n<li>🎈如果您觉得这篇文章对您有所启发或帮助，请不吝赞赏、收藏或分享。</li>\n<li>🎁您的每一个动作都是对我创作的最大鼓励和支持。</li>\n<li>👍谢谢您的阅读和陪伴！</li>\n<li>😁如果您觉得本文对您有所帮助，可以关注我的公众号 <code>BNTang</code>，我会不定期分享一些干货文章。</li>\n<li>🍻感谢您的支持，我会继续努力的！</li>\n</ul>\n</blockquote>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202312/2105804-20231211215004818-977875224.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n","prev":{"title":"uni-app全局样式和局部样式","link":"2023/12/06/Uniapp/05-uni-app全局样式和局部样式"},"next":{"title":"『云数据库』删除数据","link":"2023/12/03/Web/微信小程序/云开发/64-『云数据库』删除数据"},"plink":"http://example.com/2023/12/03/Web/微信小程序/云开发/63-『云数据库』新增数据/","toc":[{"id":"1.前言","title":"1.前言","index":"1"},{"id":"2.创建项目","title":"2.创建项目","index":"2","children":[{"id":"2.1.目录结构","title":"2.1.目录结构","index":"2.1"}]},{"id":"3.搭建演示页面","title":"3.搭建演示页面","index":"3"},{"id":"4.云数据库","title":"4.云数据库","index":"4","children":[{"id":"4.1.初始化","title":"4.1.初始化","index":"4.1"},{"id":"4.2.新增","title":"4.2.新增","index":"4.2"}]},{"id":"end","title":"End","index":"5"}]}