{"title":"『云数据库』删除数据","date":"2023-12-03T09:46:02.000Z","date_formatted":{"ll":"Dec 3, 2023","L":"12/03/2023","MM-DD":"12-03"},"link":"2023/12/03/Web/微信小程序/云开发/64-『云数据库』删除数据","tags":["云开发","微信小程序"],"updated":"2024-01-19T03:14:11.090Z","content":"<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202312/2105804-20231203183216229-866297488.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<h1 id=\"1.前言\">1.前言<a title=\"#1.前言\" href=\"#1.前言\"></a></h1>\n<p>经过上一篇文章的介绍，大家可以了解到如何在微信小程序开发中通过代码的方式来进行操作云数据库，主要分为以下几个步骤：</p>\n<ul>\n<li>1.初始化云开发环境</li>\n<li>2.拿到当前环境对应的数据库</li>\n<li>3.拿到当前数据库中指定的集合</li>\n<li>4.再通过集合进行操作数据库</li>\n</ul>\n<h1 id=\"2.代码删除\">2.代码删除<a title=\"#2.代码删除\" href=\"#2.代码删除\"></a></h1>\n<p>在删除之前，首先我得要给大家介绍一下云数据库与关系型数据库的区别，这样大家才能够更好的理解云数据库的删除操作。</p>\n<p>首先给大家看一张图：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240113110333427-1425683139.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>大家可以看到，在云数据库当中一行记录就是一个 <code>record / doc</code> ，而在关系型数据库当中一行记录就是一条数据，知道了这些之后就可以开始进行删除操作了。</p>\n<h2 id=\"2.1.根据-_id-删除\">2.1.根据 <code>_id</code> 删除<a title=\"#2.1.根据-_id-删除\" href=\"#2.1.根据-_id-删除\"></a></h2>\n<p>在云数据库当中，每一条记录都会有一个 <code>_id</code> ，这个 <code>_id</code> 就是这条记录的唯一标识，所以我们可以通过这个 <code>_id</code> 来进行删除操作。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">async</span> <span class=\"hljs-title function_\">onRemoveTap</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-comment\">// 从指定集合中找到 id 等于指定ID的那条数据，然后删除</span><br>    <span class=\"hljs-keyword\">const</span> res = <span class=\"hljs-keyword\">await</span> stuCollection.<span class=\"hljs-title function_\">doc</span>(<span class=\"hljs-string\">&#x27;c0b1b0e260d9c9d900b1b0e2a0d9c9d9&#x27;</span>).<span class=\"hljs-title function_\">remove</span>()<br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res);<br>&#125;,<br></code></pre></td></tr></table></figure>\n<p>也是首先通过拿到集合，然后再通过集合拿到指定的记录，最后再通过 <code>remove</code> 方法来进行删除操作, 这个 ID，大家自己去云控制台中获取，获取方式我就真的不多说了。</p>\n<blockquote>\n<ul>\n<li>🐤注意：这个删除操作，微信云开发默认的权限是只有创建者才能够进行删除操作，如果你想要其他人也能够进行删除操作，那么你需要在云控制台中进行设置。</li>\n<li>😁默认情况下，数据只能是添加的人才可以删除，其它人是没有权限的，可以在后台根据自己的需求修改权限，这一点大家是需要知道和了解清楚的</li>\n</ul>\n</blockquote>\n<p>我删除不是自己创建的数据，控制台出现了如下的错误：</p>\n<p><code>document.remove:fail document.remove:fail cannot remove document with _id 08bade59659d76d500164ecb5824f337, please make sure that the document exists and you have the corresponding Write permission</code></p>\n<p>该如何解决这个问题呢，我们可以在云控制台中进行设置，默认权限是 <code>仅创建者可读写</code>，我们可以进行自定义安全规则，这样就可以解决这个问题了。</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\"><span class=\"hljs-punctuation\">&#123;</span><br>  <span class=\"hljs-attr\">&quot;read&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">true</span></span><span class=\"hljs-punctuation\">,</span><br>  <span class=\"hljs-attr\">&quot;write&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">true</span></span><br><span class=\"hljs-punctuation\">&#125;</span><br></code></pre></td></tr></table></figure>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240113111735608-1234391046.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>更改完毕了权限之后我们再来进行删除：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240113112140624-682485817.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<h2 id=\"2.2.根据条件删除\">2.2.根据条件删除<a title=\"#2.2.根据条件删除\" href=\"#2.2.根据条件删除\"></a></h2>\n<h3 id=\"2.2.1.查询条件\">2.2.1.查询条件<a title=\"#2.2.1.查询条件\" href=\"#2.2.1.查询条件\"></a></h3>\n<p>通过集合的 <code>where</code> 方法可以进行条件查询，通过 <code>remove</code> 方法可以进行删除操作，这样就可以实现根据条件删除了。</p>\n<p>官方文档：<a href=\"https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.where.html\" target=\"_blank\">https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.where.html</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">async</span> <span class=\"hljs-title function_\">onRemoveTap</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-keyword\">const</span> res = <span class=\"hljs-keyword\">await</span> stuCollection.<span class=\"hljs-title function_\">where</span>(&#123;<br>        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;翠花&#x27;</span><br>    &#125;).<span class=\"hljs-title function_\">remove</span>();<br><br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res);<br>&#125;,<br></code></pre></td></tr></table></figure>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240113112953129-2007320660.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<h3 id=\"2.2.2.数据库操作符\">2.2.2.数据库操作符<a title=\"#2.2.2.数据库操作符\" href=\"#2.2.2.数据库操作符\"></a></h3>\n<p>看这种范围的删除，该如何删除之前首先要查阅一下官方文档：<a href=\"https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.where.html\" target=\"_blank\">https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.where.html</a></p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240113113905765-2625472.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>通过观察在官方代码当中首先是通过 <code>const _ = db.command</code> 来获取到 <code>command</code> 对象，然后再通过 <code>_.gt</code> 来获取到大于的条件，最后再通过 <code>where</code> 方法来进行查询。</p>\n<p>既然如此，那么我们就可以通过 <code>_.gt</code> 来获取到大于的条件，然后再通过 <code>remove</code> 方法来进行删除操作。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">async</span> <span class=\"hljs-title function_\">onRemoveTap</span>(<span class=\"hljs-params\"></span>) &#123;<br>    <span class=\"hljs-comment\">// 1.拿到条件判断工具对象</span><br>    <span class=\"hljs-keyword\">const</span> _ = db.<span class=\"hljs-property\">command</span>;<br>    <span class=\"hljs-keyword\">const</span> res = <span class=\"hljs-keyword\">await</span> stuCollection.<span class=\"hljs-title function_\">where</span>(&#123;<br>        <span class=\"hljs-attr\">age</span>: _.<span class=\"hljs-title function_\">lt</span>(<span class=\"hljs-number\">19</span>)<br>    &#125;).<span class=\"hljs-title function_\">remove</span>();<br><br>    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res);<br>&#125;,<br></code></pre></td></tr></table></figure>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240113114312579-772097538.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p><code>const _ = db.command;</code>，通过这个语句我们就可以获取到条件判断工具对象，然后再通过 <code>_.lt</code> 来获取到小于的条件，除了小于之外还有很多的条件，大家可以自己去查阅一下官方文档。</p>\n<p><a href=\"https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/Command.html\" target=\"_blank\">https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/Command.html</a></p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202401/2105804-20240113114424832-1955785678.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>本篇文章内容介绍到这就结束了，我们下期再见，感谢大家的观看，谢谢大家。</p>\n<blockquote>\n<ul>\n<li>🐤如果您对本文有任何疑问或想法，请在评论区留言，我将很乐意与您交流。</li>\n<li>🐰您的每一条评论对我都至关重要，我会尽快给予回复。</li>\n<li>🎈如果您觉得这篇文章对您有所启发或帮助，请不吝赞赏、收藏或分享。</li>\n<li>🎁您的每一个动作都是对我创作的最大鼓励和支持。</li>\n<li>👍谢谢您的阅读和陪伴！</li>\n<li>😁如果您觉得本文对您有所帮助，可以关注我的公众号 <code>BNTang</code>，我会不定期分享一些干货文章。</li>\n<li>🍻感谢您的支持，我会继续努力的！</li>\n</ul>\n</blockquote>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202312/2105804-20231211215004818-977875224.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n","prev":{"title":"『云数据库』新增数据","link":"2023/12/03/Web/微信小程序/云开发/63-『云数据库』新增数据"},"next":{"title":"『云数据库』更新数据","link":"2023/12/03/Web/微信小程序/云开发/65-『云数据库』更新数据"},"plink":"http://example.com/2023/12/03/Web/微信小程序/云开发/64-『云数据库』删除数据/","toc":[{"id":"1.前言","title":"1.前言","index":"1"},{"id":"2.代码删除","title":"2.代码删除","index":"2","children":[{"id":"2.1.根据-_id-删除","title":"2.1.根据 _id 删除","index":"2.1"},{"id":"2.2.根据条件删除","title":"2.2.根据条件删除","index":"2.2","children":[{"id":"2.2.1.查询条件","title":"2.2.1.查询条件","index":"2.2.1"},{"id":"2.2.2.数据库操作符","title":"2.2.2.数据库操作符","index":"2.2.2"}]}]}]}