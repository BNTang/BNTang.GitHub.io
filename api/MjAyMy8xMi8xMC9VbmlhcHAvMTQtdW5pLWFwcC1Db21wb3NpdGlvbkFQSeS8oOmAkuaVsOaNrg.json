{"title":"uni-app-CompositionAPI传递数据","date":"2023-12-10T08:59:15.000Z","date_formatted":{"ll":"Dec 10, 2023","L":"12/10/2023","MM-DD":"12-10"},"link":"2023/12/10/Uniapp/14-uni-app-CompositionAPI传递数据","tags":["Uniapp"],"updated":"2023-12-10T10:28:36.150Z","content":"<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202312/2105804-20231203181725538-1937927529.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<h1 id=\"前言\">前言<a title=\"#前言\" href=\"#前言\"></a></h1>\n<ul>\n<li>好，经过上个章节的介绍完毕之后，了解了一下 uni-app-传递数据</li>\n<li>那么了解完了uni-app-传递数据之后，这篇文章来给大家介绍一下 uni-app-CompositionAPI传递数据</li>\n<li>首先不管三七二十一，先来新建一个项目</li>\n</ul>\n<h1 id=\"搭建演示环境\">搭建演示环境<a title=\"#搭建演示环境\" href=\"#搭建演示环境\"></a></h1>\n<p>创建一个全新的项目：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202312/2105804-20231210171109761-2087901633.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>然后在配置一下，微信小程序的 AppId，直接去之前的项目中拷贝一下即可，找到之前项目的 <code>manifest.json</code> 文件，然后选择微信小程序配置，复制一下即可。</p>\n<ul>\n<li>经过如上的这么一顿操作之后，就可以搭建完毕运行环境，与编码环境</li>\n<li>接下来就可以开始进行介绍 uni-app-CompositionAPI传递数据内容了</li>\n</ul>\n<h1 id=\"步入正题\">步入正题<a title=\"#步入正题\" href=\"#步入正题\"></a></h1>\n<h2 id=\"通过路径拼接传递数据\">通过路径拼接传递数据<a title=\"#通过路径拼接传递数据\" href=\"#通过路径拼接传递数据\"></a></h2>\n<p>创建一个 one 页面，我们在首页当中编写一个按钮，点击按钮跳转到 one 页面，然后在 one 页面当中显示传递过来的数据，我这里是通过 CompositionAPI 来进行传递数据的，代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs vue\">&lt;template&gt;<br>\t&lt;view&gt;<br>\t\t&lt;button type=&quot;primary&quot; @click=&quot;onJumpOne&quot;&gt;跳转到One界面&lt;/button&gt;<br>\t&lt;/view&gt;<br>&lt;/template&gt;<br><br>&lt;script setup&gt;<br>\tfunction onJumpOne() &#123;<br>\t\tuni.navigateTo(&#123;<br>\t\t\turl: &#x27;/pages/one/one?name=BNTang&amp;age=18&#x27;<br>\t\t&#125;)<br>\t&#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n<p>然后在 one 页面当中接收数据，代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs vue\">&lt;template&gt;<br>\t&lt;view&gt;<br>\t\t&lt;text&gt;One&lt;/text&gt;<br>\t&lt;/view&gt;<br>&lt;/template&gt;<br><br>&lt;script setup&gt;<br>\timport &#123;<br>\t\tonLoad<br>\t&#125; from &#x27;@dcloudio/uni-app&#x27;<br><br>\tonLoad((option) =&gt; &#123;<br>\t\tconsole.log(option)<br>\t&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n<p>然后我们点击按钮，跳转到 one 页面，可以看到控制台打印出了我们传递过来的数据：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202312/2105804-20231210174845270-231571997.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>除了通过 option 来接收数据之外，我们还可以通过 props 来接收数据，代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs vue\">&lt;script setup&gt;<br>\tconst props = defineProps(&#123;<br>\t\tname: String,<br>\t\tage: Number<br>\t&#125;)<br>\tconsole.log(props.name, props.age);<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n<p>好了，这是正向传递数据，那么反向传递数据呢？</p>\n<h2 id=\"反向传递数据\">反向传递数据<a title=\"#反向传递数据\" href=\"#反向传递数据\"></a></h2>\n<p>我们在 one 页面当中编写一个按钮，点击按钮跳转到首页页面，然后在首页页面当中显示传递过来的数据，代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs vue\">&lt;template&gt;<br>\t&lt;view&gt;<br>\t\t&lt;text&gt;One&lt;/text&gt;<br>\t\t&lt;button type=&quot;primary&quot; @click=&quot;goBackClick&quot;&gt;返回首页&lt;/button&gt;<br>\t&lt;/view&gt;<br>&lt;/template&gt;<br><br>&lt;script setup&gt;<br>\tfunction goBackClick() &#123;<br>\t\tuni.navigateBack(&#123;<br>\t\t\tdelta: 1<br>\t\t&#125;);<br>\t&#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n<p>页面已经搭建好了，那么我们就可以开始传递数据了，在之前我们是通过 <code>this.getOpenerEventChannel();</code> 来进行传递数据的，但是在 CompositionAPI 当中没有 this，那么我们现在要做的第一件事情就是获取 this，在 compositionAPI 当中获取 this 可以通过 <code>getCurrentInstance()</code> 来获取，代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs vue\">&lt;script setup&gt;<br>\timport &#123;<br>\t\tref,<br>\t\tgetCurrentInstance<br>\t&#125; from &#x27;vue&#x27;<br><br>\t// 获取 this<br>\tconst $instance = ref(getCurrentInstance().proxy)<br><br>    ... other<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n<p>竟然获取到了 this，那么接下来的代码就和之前的一样了，代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs vue\">&lt;script setup&gt;<br>\timport &#123;<br>\t\tref,<br>\t\tgetCurrentInstance<br>\t&#125; from &#x27;vue&#x27;<br><br>\t// 获取 this<br>\tconst $instance = ref(getCurrentInstance().proxy)<br><br>\tfunction goBackClick() &#123;<br>\t\tuni.navigateBack(&#123;<br>\t\t\tdelta: 1<br>\t\t&#125;);<br>\t\t<br>\t\tconst eventChannel = $instance.value.getOpenerEventChannel();<br>\t\teventChannel.emit(&quot;acceptDataFromOpenerPage&quot;, &#123;<br>\t\t\tdata: &#x27;通过事件通道返回时传递数据&#x27;<br>\t\t&#125;)<br>\t&#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n<p>如上代码就是我们之前的逆着传递数据的代码，改动的点就是之前是 this.getOpenerEventChannel(); 现在是 $instance.value.getOpenerEventChannel();，然后我们在首页当中接收数据，代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs vue\">&lt;script setup&gt;<br>\tfunction onJumpOne() &#123;<br>\t\tuni.navigateTo(&#123;<br>\t\t\turl: &#x27;/pages/one/one?name=BNTang&amp;age=18&#x27;,<br>\t\t\tevents: &#123;<br>\t\t\t\tacceptDataFromOpenerPage(data) &#123;<br>\t\t\t\t\tconsole.log(data)<br>\t\t\t\t&#125;<br>\t\t\t&#125;<br>\t\t&#125;)<br>\t&#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n<p>运行一下，点击按钮跳转到 one 页面，然后点击返回按钮，可以看到控制台打印出了我们传递过来的数据：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202312/2105804-20231210182234923-1024341864.gif\" alt loading=\"lazy\" class=\"φbp\"></p>\n<h2 id=\"正向传递数据\">正向传递数据<a title=\"#正向传递数据\" href=\"#正向传递数据\"></a></h2>\n<p>那么逆向传递看完了，正向传递就来快速过一下，首先更改首页的代码，代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs vue\">&lt;script setup&gt;<br>\tfunction onJumpOne() &#123;<br>\t\tuni.navigateTo(&#123;<br>\t\t\turl: &#x27;/pages/one/one&#x27;,<br>\t\t\tsuccess(res) &#123;<br>\t\t\t\t// 通过eventChannel向被打开页面传送数据<br>\t\t\t\tres.eventChannel.emit(&#x27;acceptDataFromOpenerPage&#x27;, &#123;<br>\t\t\t\t\tdata: &#x27;通过事件通道传递的数据&#x27;<br>\t\t\t\t&#125;)<br>\t\t\t&#125;<br>\t\t&#125;)<br>\t&#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n<p>然后在 one 页面当中接收数据，代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs vue\">&lt;script setup&gt;<br>\timport &#123;<br>\t\tref,<br>\t\tgetCurrentInstance<br>\t&#125; from &#x27;vue&#x27;<br>\timport &#123;<br>\t\tonLoad<br>\t&#125; from &#x27;@dcloudio/uni-app&#x27;<br><br>\t// 获取 this<br>\tconst $instance = ref(getCurrentInstance().proxy)<br><br>\tonLoad((option) =&gt; &#123;<br>\t\tconst eventChannel = $instance.value.getOpenerEventChannel();<br>\t\teventChannel.on(&#x27;acceptDataFromOpenerPage&#x27;, function(data) &#123;<br>\t\t\tconsole.log(data)<br>\t\t&#125;)<br>\t&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>\n<p>运行一下，点击按钮跳转到 one 页面，可以看到控制台打印出了我们传递过来的数据：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202312/2105804-20231210182803710-1321836758.gif\" alt loading=\"lazy\" class=\"φbp\"></p>\n<h1 id=\"最后\">最后<a title=\"#最后\" href=\"#最后\"></a></h1>\n<p>大家好我是 BNTang, 一个热爱分享的技术的开发者，如果大家觉得我的文章对你有帮助的话，可以关注我的公众号 <code>BNTang</code>，我会在公众号中分享一些IT技术和一些个人的见解，谢谢大家的支持。</p>\n<blockquote>\n<p><a href=\"https://cloud.tencent.com/developer/article/2366050?from_column=20421&amp;from=20421\" target=\"_blank\">我正在参与2023腾讯技术创作特训营第四期有奖征文，快来和我瓜分大奖！</a></p>\n</blockquote>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202311/2105804-20231129232539490-1458223711.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n","prev":{"title":"uni-app-数据传递补充","link":"2023/12/10/Uniapp/15-uni-app-数据传递补充"},"next":{"title":"uni-app-传递数据","link":"2023/12/10/Uniapp/13-uni-app-传递数据"},"plink":"http://example.com/2023/12/10/Uniapp/14-uni-app-CompositionAPI传递数据/","toc":[{"id":"前言","title":"前言","index":"1"},{"id":"搭建演示环境","title":"搭建演示环境","index":"2"},{"id":"步入正题","title":"步入正题","index":"3","children":[{"id":"通过路径拼接传递数据","title":"通过路径拼接传递数据","index":"3.1"},{"id":"反向传递数据","title":"反向传递数据","index":"3.2"},{"id":"正向传递数据","title":"正向传递数据","index":"3.3"}]},{"id":"最后","title":"最后","index":"4"}],"reading_time":"1282 words in 9 min"}
