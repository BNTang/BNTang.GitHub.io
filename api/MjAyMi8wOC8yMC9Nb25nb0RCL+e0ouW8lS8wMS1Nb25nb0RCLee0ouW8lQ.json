{"title":"MongoDB-索引","date":"2022-08-20T07:25:55.000Z","date_formatted":{"ll":"Aug 20, 2022","L":"08/20/2022","MM-DD":"08-20"},"link":"2022/08/20/MongoDB/索引/01-MongoDB-索引","tags":["MongoDB"],"updated":"2022-08-20T13:25:38.568Z","content":"<h1 id=\"什么是索引\">什么是索引<a title=\"#什么是索引\" href=\"#什么是索引\"></a></h1>\n<ul>\n<li>索引就相当于字典中的目录(拼音 / 偏旁部首手)</li>\n<li>有了目录我们就能通过目录快速的找到想要的结果</li>\n<li>但是如果没有目录(拼音 / 偏旁部首手), 没有索引</li>\n<li>那么如果想要查找某条数据就必须从前往后一条一条的查找</li>\n<li>所以, 索引就是用于提升数据的查询速度的</li>\n</ul>\n<p>?&gt; 插入测试数据：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.person.insert(<span class=\"hljs-punctuation\">[</span><br>    <span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;cs&#x27;<span class=\"hljs-punctuation\">,</span> age<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">19</span><span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;as&#x27;<span class=\"hljs-punctuation\">,</span> age<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">18</span><span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;bs&#x27;<span class=\"hljs-punctuation\">,</span> age<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">17</span><span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br><span class=\"hljs-punctuation\">]</span>);<br></code></pre></td></tr></table></figure>\n<h1 id=\"如何获取索引\">如何获取索引<a title=\"#如何获取索引\" href=\"#如何获取索引\"></a></h1>\n<ul>\n<li>格式如下：</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.&lt;collection&gt;.getIndexes()<br></code></pre></td></tr></table></figure>\n<ul>\n<li>示例：</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.person.getIndexes();<br></code></pre></td></tr></table></figure>\n<h1 id=\"如何创建索引\">如何创建索引<a title=\"#如何创建索引\" href=\"#如何创建索引\"></a></h1>\n<ul>\n<li>格式如下：</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.&lt;collection&gt;.createIndex(<span class=\"hljs-punctuation\">&#123;</span>&lt;field&gt;<span class=\"hljs-punctuation\">:</span> &lt;<span class=\"hljs-number\">1</span> or <span class=\"hljs-number\">-1</span>&gt;<span class=\"hljs-punctuation\">,</span> ...<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span> &lt;options&gt;)<br></code></pre></td></tr></table></figure>\n<ul>\n<li>\n<p>&lt;field&gt;: 指定创建索引的字段(后面的数字分别代表：1 升序，-1 降序)</p>\n</li>\n<li>\n<p>&lt;options&gt;: 索引的额外配置</p>\n</li>\n<li>\n<p>示例:</p>\n</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.person.createIndex(<span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">1</span><span class=\"hljs-punctuation\">&#125;</span>)<br></code></pre></td></tr></table></figure>\n<p>如上索引创建之后的数据结构如下，给的是 1 所以是从大到小：</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs text\">as: -&gt; &#123;name: &#x27;as&#x27;, age: 18&#125;<br>bs: -&gt; &#123;name: &#x27;bs&#x27;, age: 17&#125;<br>cs: -&gt; &#123;name: &#x27;cs&#x27;, age: 19&#125;<br></code></pre></td></tr></table></figure>\n<p>如果是 -1 那么对应的数据结构同理可证是从小到大了。</p>\n<h1 id=\"创建单键索引\">创建单键索引<a title=\"#创建单键索引\" href=\"#创建单键索引\"></a></h1>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.person.createIndex(<span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">1</span><span class=\"hljs-punctuation\">&#125;</span>)<br></code></pre></td></tr></table></figure>\n<h1 id=\"查看是否使用索引\">查看是否使用索引<a title=\"#查看是否使用索引\" href=\"#查看是否使用索引\"></a></h1>\n<ul>\n<li>\n<p>和 MySQL 一样, 我们可以通过 <code>explain</code> 来查看索引效果</p>\n</li>\n<li>\n<p>格式如下：</p>\n</li>\n</ul>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs text\">db.&lt;collection&gt;.explain().&lt;method()&gt;<br></code></pre></td></tr></table></figure>\n<ul>\n<li>示例：</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.person.explain().find(<span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span> &#x27;as&#x27;<span class=\"hljs-punctuation\">&#125;</span>)<br></code></pre></td></tr></table></figure>\n<p>在查询的结构当中只需要关心，<code>winningPlan</code> 的这个 key 对应的 <code>stage</code> 的取值即可，stage 不同取值所对应的含义如下：</p>\n<ul>\n<li>winningPlan -&gt; stage -&gt; COLLSCAN -&gt; 遍历整个集合查询</li>\n<li>winningPlan -&gt; stage -&gt; IXSCAN -&gt; 通过索引查询</li>\n<li>winningPlan -&gt; stage -&gt; FETCH -&gt; 根据索引存储的地址取出对应文档</li>\n</ul>\n<p>!&gt; 和 MySQL 一样, MongoDB 默认也会为主键自动创建索引</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.person.getIndexes();<br></code></pre></td></tr></table></figure>\n<p>!&gt; 如果查询条件中只需要查询出索引字段, 那么就不会再取出完整文档, 这样效率更高</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.person.explain().find(<span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span> &#x27;as&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-punctuation\">&#123;</span>_id<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">0</span><span class=\"hljs-punctuation\">,</span> name<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">1</span><span class=\"hljs-punctuation\">&#125;</span>)<br></code></pre></td></tr></table></figure>","prev":{"title":"MongoDB-复合索引","link":"2022/08/20/MongoDB/索引/02-MongoDB-复合索引"},"next":{"title":"MongoDB-数据类型转换操作符","link":"2022/08/14/MongoDB/05-MongoDB-数据类型转换操作符"},"plink":"http://example.com/2022/08/20/MongoDB/索引/01-MongoDB-索引/","toc":[{"id":"什么是索引","title":"什么是索引","index":"1"},{"id":"如何获取索引","title":"如何获取索引","index":"2"},{"id":"如何创建索引","title":"如何创建索引","index":"3"},{"id":"创建单键索引","title":"创建单键索引","index":"4"},{"id":"查看是否使用索引","title":"查看是否使用索引","index":"5"}],"reading_time":"484 words in 3 min"}