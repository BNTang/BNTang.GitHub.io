{"title":"手撕Vue-提取元素到内存","date":"2023-10-14T09:54:58.000Z","date_formatted":{"ll":"Oct 14, 2023","L":"10/14/2023","MM-DD":"10-14"},"link":"2023/10/14/手写Vue全家桶/05-手撕Vue-提取元素到内存","tags":["手写Vue全家桶"],"updated":"2023-10-14T10:35:53.556Z","content":"<p>接着上一篇文章，我们已经实现了构建Vue实例的过程，接下来我们要实现的是提取元素到内存。</p>\n<p>主要是通过文档碎片来实现，文档碎片是一个轻量级的文档，可以包含和控制节点，但是不会像真实的DOM那样占用内存，所以我们可以通过文档碎片来提高性能。</p>\n<p>大致的思路是这样的：</p>\n<ol>\n<li>创建一个空的文档碎片对象</li>\n<li>编译循环取到每一个元素</li>\n<li>返回存储了所有元素的文档碎片对象</li>\n</ol>\n<p>在这个思路当中有一个注意点：</p>\n<p>!&gt; 只要将元素添加到了文档碎片对象中, 那么这个元素就会自动从网页上消失</p>\n<p>大概是这样的，例如我们页面当中有一个 p 元素，我们将这个元素添加到文档碎片当中，那么这个元素就会从页面上消失，但是我们可以通过文档碎片对象来访问这个元素。</p>\n<p>好了基本上就是这样的，我们来看一下代码：</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/2105804/202310/2105804-20231014181104562-516597957.png\" alt=\"image-20231014181103761\" loading=\"lazy\" class=\"φbp\"></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-comment\">// 2.根据指定的区域和数据去编译渲染界面</span><br><span class=\"hljs-keyword\">if</span> (<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">$el</span>) &#123;<br>    <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Compiler</span>(<span class=\"hljs-variable language_\">this</span>);<br>&#125;<br></code></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Compiler</span> &#123;<br>    <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\">vm</span>) &#123;<br>        <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">vm</span> = vm;<br><br>        <span class=\"hljs-comment\">// 1.将网页上的元素放到内存中</span><br>        <span class=\"hljs-keyword\">let</span> fragment = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">node2fragment</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">vm</span>.<span class=\"hljs-property\">$el</span>);<br>        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(fragment);<br>    &#125;<br><br>    <span class=\"hljs-title function_\">node2fragment</span>(<span class=\"hljs-params\">app</span>) &#123;<br>        <span class=\"hljs-comment\">// 1.创建一个空的文档碎片对象</span><br>        <span class=\"hljs-keyword\">let</span> fragment = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createDocumentFragment</span>();<br><br>        <span class=\"hljs-comment\">// 2.编译循环取到每一个元素</span><br>        <span class=\"hljs-keyword\">let</span> node = app.<span class=\"hljs-property\">firstChild</span>;<br>        <span class=\"hljs-keyword\">while</span> (node) &#123;<br>            fragment.<span class=\"hljs-title function_\">appendChild</span>(node);<br>            node = app.<span class=\"hljs-property\">firstChild</span>;<br>        &#125;<br><br>        <span class=\"hljs-comment\">// 3.返回存储了所有元素的文档碎片对象</span><br>        <span class=\"hljs-keyword\">return</span> fragment;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n","prev":{"title":"手撕Vue-查找指令和模板","link":"2023/10/15/手写Vue全家桶/06-手撕Vue-查找指令和模板"},"next":{"title":"手撕Vue-构建Vue实例","link":"2023/10/14/手写Vue全家桶/04-手撕Vue-构建Vue实例"},"plink":"http://example.com/2023/10/14/手写Vue全家桶/05-手撕Vue-提取元素到内存/","reading_time":"447 words in 3 min"}