{"title":"MongoDB-聚合操作表达式","date":"2022-08-13T11:37:00.000Z","date_formatted":{"ll":"Aug 13, 2022","L":"08/13/2022","MM-DD":"08-13"},"link":"2022/08/13/MongoDB/04-MongoDB-聚合操作表达式","tags":["MongoDB"],"updated":"2022-08-14T08:36:46.308Z","content":"<h1 id=\"字段路径表达式\">字段路径表达式<a title=\"#字段路径表达式\" href=\"#字段路径表达式\"></a></h1>\n<ul>\n<li><code>$&lt;filed&gt;</code>: 使用 <code>$</code> 来指示字段路径</li>\n<li><code>$&lt;filed&gt;.&lt;sub-field&gt;</code>: 使用 <code>$</code> 和 <code>.</code> 来指示内嵌文档字段路径</li>\n</ul>\n<h2 id=\"示例\">示例<a title=\"#示例\" href=\"#示例\"></a></h2>\n<p>添加测试数据：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.person.insert(<span class=\"hljs-punctuation\">[</span><br>    <span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span>firstName<span class=\"hljs-punctuation\">:</span>&#x27;Jonathan&#x27;<span class=\"hljs-punctuation\">,</span> lastName<span class=\"hljs-punctuation\">:</span>&#x27;Lee&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span> age<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">18</span><span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span>firstName<span class=\"hljs-punctuation\">:</span>&#x27;Amelie&#x27;<span class=\"hljs-punctuation\">,</span> lastName<span class=\"hljs-punctuation\">:</span>&#x27;Tang&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span> age<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">19</span><span class=\"hljs-punctuation\">&#125;</span><br><span class=\"hljs-punctuation\">]</span>)<br></code></pre></td></tr></table></figure>\n<ul>\n<li>$name</li>\n<li>$name.firstName</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.person.aggregate(<span class=\"hljs-punctuation\">[</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        $project<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>            _id<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">0</span><span class=\"hljs-punctuation\">,</span><br>            myName<span class=\"hljs-punctuation\">:</span> &#x27;$name.firstName&#x27;<span class=\"hljs-punctuation\">,</span><br>            myName2<span class=\"hljs-punctuation\">:</span> &#x27;$name&#x27;<br>        <span class=\"hljs-punctuation\">&#125;</span><br>    <span class=\"hljs-punctuation\">&#125;</span><br><span class=\"hljs-punctuation\">]</span>)<br></code></pre></td></tr></table></figure>\n<h1 id=\"系统变量表达式\">系统变量表达式<a title=\"#系统变量表达式\" href=\"#系统变量表达式\"></a></h1>\n<ul>\n<li><code>$$CURRENT</code>: 表示当前操作的文档</li>\n</ul>\n<h2 id=\"示例-1\">示例<a title=\"#示例-1\" href=\"#示例-1\"></a></h2>\n<ul>\n<li>$$CURRENT.name -&gt; 等价于 $name</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.person.aggregate(<span class=\"hljs-punctuation\">[</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        $project<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>            _id<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">0</span><span class=\"hljs-punctuation\">,</span><br>            myName<span class=\"hljs-punctuation\">:</span> &#x27;$$CURRENT.name&#x27;<br>        <span class=\"hljs-punctuation\">&#125;</span><br>    <span class=\"hljs-punctuation\">&#125;</span><br><span class=\"hljs-punctuation\">]</span>)<br></code></pre></td></tr></table></figure>\n<h1 id=\"常量表达式\">常量表达式<a title=\"#常量表达式\" href=\"#常量表达式\"></a></h1>\n<ul>\n<li><code>$literal: &lt;value&gt;</code>: 表示常量 <code>&lt;value&gt;</code></li>\n</ul>\n<h2 id=\"示例-2\">示例<a title=\"#示例-2\" href=\"#示例-2\"></a></h2>\n<ul>\n<li><code>$literal: '$name'</code>: 表示常量字符串 <code>$name</code></li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.person.aggregate(<span class=\"hljs-punctuation\">[</span><br>    <span class=\"hljs-punctuation\">&#123;</span><br>        $project<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span><br>            _id<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">0</span><span class=\"hljs-punctuation\">,</span><br>            myName<span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span>$literal<span class=\"hljs-punctuation\">:</span> &#x27;BNTang&#x27;<span class=\"hljs-punctuation\">&#125;</span><br>        <span class=\"hljs-punctuation\">&#125;</span><br>    <span class=\"hljs-punctuation\">&#125;</span><br><span class=\"hljs-punctuation\">]</span>)<br></code></pre></td></tr></table></figure>","prev":{"title":"MongoDB-聚合操作$project","link":"2022/08/13/MongoDB/001-MongoDB-聚合操作$project"},"next":{"title":"MongoDB-聚合操作额外配置","link":"2022/08/13/MongoDB/03-MongoDB-聚合操作额外配置"},"plink":"http://example.com/2022/08/13/MongoDB/04-MongoDB-聚合操作表达式/","toc":[{"id":"字段路径表达式","title":"字段路径表达式","index":"1","children":[{"id":"示例","title":"示例","index":"1.1"}]},{"id":"系统变量表达式","title":"系统变量表达式","index":"2","children":[{"id":"示例-1","title":"示例","index":"2.1"}]},{"id":"常量表达式","title":"常量表达式","index":"3","children":[{"id":"示例-2","title":"示例","index":"3.1"}]}],"reading_time":"169 words in 1 min"}