{"title":"MongoDB-数据类型转换操作符","date":"2022-08-14T15:28:56.000Z","date_formatted":{"ll":"Aug 14, 2022","L":"08/14/2022","MM-DD":"08-14"},"link":"2022/08/14/MongoDB/05-MongoDB-数据类型转换操作符","tags":["MongoDB"],"updated":"2022-08-14T16:36:38.789Z","content":"<h1 id=\"数据类型转换操作符\">数据类型转换操作符<a title=\"#数据类型转换操作符\" href=\"#数据类型转换操作符\"></a></h1>\n<p>?&gt; MongoDB 对于文档的格式并没有强制性的要求, 同一个集合中存储的文档, 字段的个数和数据类型都可以不同, 对与文档的格式没有强制性的要求是 MongoDB 的一大优势, 但是同时也增加了数据消费端的使用难度, 因为我们在使用数据的时候, 有可能同一个字段取出来的数据类型是不同的, 这样非常不利于我们后续操作, 所以也正是因为如此, MongoDB 在 <code>4.0</code> 中 推出了 <code>$convert</code> 数据类型转换操作符, 通过 $convert 数据类型转换操作符, 我们可以将不同的数据类型转换成相同的数据类型, 以便于后续我们在使用数据的过程中能够统一对数据进行处理</p>\n<h1 id=\"$convert-格式\">$convert 格式<a title=\"#$convert-格式\" href=\"#$convert-格式\"></a></h1>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs text\">&#123;$convert:&#123;<br>    input: &#x27;需要转换的字段&#x27;,<br>    to: &#x27;转换之后的数据类型&#x27;,<br>    onError: &#x27;不支持的转换类型&#x27;,<br>    onNull: &#x27;没有需要转换的数据&#x27;<br>&#125;&#125;<br></code></pre></td></tr></table></figure>\n<h1 id=\"示例\">示例<a title=\"#示例\" href=\"#示例\"></a></h1>\n<ul>\n<li>添加测试数据</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.person.insert(<span class=\"hljs-punctuation\">[</span><br>    <span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;zs&#x27;<span class=\"hljs-punctuation\">,</span> timestamp<span class=\"hljs-punctuation\">:</span>ISODate(&#x27;<span class=\"hljs-number\">2020</span><span class=\"hljs-number\">-08</span><span class=\"hljs-number\">-09</span>T11<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">23</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">34.733</span>Z&#x27;)<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;ls&#x27;<span class=\"hljs-punctuation\">,</span> timestamp<span class=\"hljs-punctuation\">:</span>&#x27;<span class=\"hljs-number\">2021</span><span class=\"hljs-number\">-02</span><span class=\"hljs-number\">-14</span> <span class=\"hljs-number\">12</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">00</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">06</span> +<span class=\"hljs-number\">0800</span>  &#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;ww&#x27;<span class=\"hljs-punctuation\">,</span> timestamp<span class=\"hljs-punctuation\">:</span>&#x27;  <span class=\"hljs-number\">2023</span><span class=\"hljs-number\">-04</span><span class=\"hljs-number\">-01</span>T12<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">00</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">00</span>Z&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;zl&#x27;<span class=\"hljs-punctuation\">,</span> timestamp<span class=\"hljs-punctuation\">:</span>&#x27;<span class=\"hljs-number\">1587009270000</span>&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;BNTang&#x27;<span class=\"hljs-punctuation\">,</span> timestamp<span class=\"hljs-punctuation\">:</span>&#x27;Sunday&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br>    <span class=\"hljs-punctuation\">&#123;</span>name<span class=\"hljs-punctuation\">:</span>&#x27;XiaoHuihui&#x27;<span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span><br><span class=\"hljs-punctuation\">]</span>)<br></code></pre></td></tr></table></figure>\n<ul>\n<li>运用</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">db.person.aggregate(<span class=\"hljs-punctuation\">[</span><br>    <span class=\"hljs-punctuation\">&#123;</span>$project<span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>        _id<span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">0</span><span class=\"hljs-punctuation\">,</span><br>        timestamp<span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>            $convert<span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">&#123;</span><br>                input<span class=\"hljs-punctuation\">:</span>&#x27;$timestamp&#x27;<span class=\"hljs-punctuation\">,</span><br>                to<span class=\"hljs-punctuation\">:</span>&#x27;date&#x27;<span class=\"hljs-punctuation\">,</span><br>                onError<span class=\"hljs-punctuation\">:</span> &#x27;不支持的转换类型&#x27;<span class=\"hljs-punctuation\">,</span><br>                onNull<span class=\"hljs-punctuation\">:</span> &#x27;没有需要转换的数据&#x27;<br>            <span class=\"hljs-punctuation\">&#125;</span><br>        <span class=\"hljs-punctuation\">&#125;</span><br>    <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">&#125;</span><br><span class=\"hljs-punctuation\">]</span>)<br></code></pre></td></tr></table></figure>","prev":{"title":"MongoDB-索引","link":"2022/08/20/MongoDB/索引/01-MongoDB-索引"},"next":{"title":"MongoDB-聚合操作$project","link":"2022/08/13/MongoDB/001-MongoDB-聚合操作$project"},"plink":"http://example.com/2022/08/14/MongoDB/05-MongoDB-数据类型转换操作符/","toc":[{"id":"数据类型转换操作符","title":"数据类型转换操作符","index":"1"},{"id":"$convert-格式","title":"$convert 格式","index":"2"},{"id":"示例","title":"示例","index":"3"}],"reading_time":"375 words in 3 min"}